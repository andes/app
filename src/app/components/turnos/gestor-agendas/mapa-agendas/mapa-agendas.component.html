<plex-layout main="{{ (accion === 'verDetalle') ? 9 : 12 }}">
    <plex-layout-main>
        <plex-title titulo="CALENDARIO DE TURNOS">
            <plex-datetime *ngIf="verSemana" type="date" label="" [skipBy]="'week'" [(ngModel)]="diaInicio"
                           name="fechaSkip" required>
            </plex-datetime>
            <plex-datetime *ngIf="verMes" type="date" label="" [skipBy]="'month'" [(ngModel)]="diaInicio"
                           name="fechaSkip" (change)="visualizarMes()" required>
            </plex-datetime>

            <plex-button class="ml-2 mr-2" type="info" label="Mes" (click)="visualizarMes()"
                         tooltip="ver agendas del mes">
            </plex-button>
        </plex-title>

        <mapa-agenda-mes *ngIf="verMes" [fecha]="diaInicio" (semanaDetalle)="visualizarSemana($event)"
                         (agendasDetalles)="verAgendas($event)">
        </mapa-agenda-mes>

        <mapa-agenda-semana *ngIf="verSemana" [calendario]="calendario" (diaDetalle)="turnos($event)"
                            [fecha]="diaInicio">
        </mapa-agenda-semana>

    </plex-layout-main>

    <plex-layout-sidebar *ngIf='accion && verMes' type="invert">
        <plex-title titulo="detalle del dia" size="md">
            <plex-button size="sm" class="mr-1" type="danger" icon="close" (click)="close()">
            </plex-button>
        </plex-title>

        <plex-detail>
            <plex-icon name="turno-bold" type="info"></plex-icon>
            <plex-badge size="lg" type="info" class="mr-1">Agendas
                <span dato>{{dia.agendas.length}}</span>
            </plex-badge>

            <div title> {{ dia.fecha | date:'EEEE' }} {{ dia.fecha | date:'dd/MM/yyyy' }} </div>
        </plex-detail>
        <plex-title titulo="Agendas" size="sm"></plex-title>

        <plex-accordion *ngFor="let agenda of dia.agendas">

            <plex-panel *ngIf="agenda">
                <div plex-accordion-title>
                    {{agenda.tipoPrestacion.term}} |
                    {{agenda.agenda.horaInicio | date:'HH:mm'}}-{{agenda.agenda.horaFin | date:'HH:mm'}}
                    <plex-badge type="info">{{agenda.asignados.length}}/{{agenda.asignados.length+
                        agenda.disponible.length}}</plex-badge>
                </div>
                <plex-list *ngIf="agenda.asignados.length>0">
                    <ng-container *ngFor="let turnoAsignado of agenda.asignados">
                        <plex-item [selectable]="turnoAsignado.selectable">
                            <plex-icon name="turno-bold" type="info"></plex-icon>
                            <plex-label titulo="{{turnoAsignado.horaInicio | date: 'dd/MM/yyyy'}} | {{turnoAsignado.horaInicio | date: 'HH:mm'}}"
                                        subtitulo="Otro subtÃ­tulo" size="sm">
                            </plex-label>

                        </plex-item>
                    </ng-container>
                </plex-list>
            </plex-panel>
        </plex-accordion>

    </plex-layout-sidebar>

    <plex-layout-sidebar *ngIf='accion && verSemana' type="invert">
        <plex-title titulo="detalle del dia" size="md">
            <plex-button size="sm" class="mr-1" type="danger" icon="close" (click)="close()">
            </plex-button>
        </plex-title>
        <plex-detail>
            <plex-icon name="turno-bold" type="info"></plex-icon>
            <plex-badge size="lg" type="info" class="mr-1">turnos
                <span dato>{{dia.turnos.length}}</span>
            </plex-badge>

            <div title> {{ dia.turnos[0].horaInicio | date :"EEEE"}} {{ dia.turnos[0].horaInicio | date :"dd/MM/yy"}}
            </div>
        </plex-detail>
        <plex-title titulo="Turnos" size="sm"></plex-title>

        <plex-accordion *ngFor="let turno of dia.turnos">

            <plex-panel>
                <div plex-accordion-title>
                    {{turno.paciente.apellido}} , {{turno.paciente.nombre}} | {{turno.horaInicio | date: 'HH:mm'}}

                </div>
                <plex-detail size="sm">
                    <plex-badge *ngIf="turno.estado" size="sm">{{ turno.estado }}</plex-badge>
                    <plex-label titulo="Prestacion" subtitulo="{{turno.tipoPrestacion.term}}"></plex-label>
                    <plex-label *ngIf="turno.agenda.espacioFisico" titulo="Espacio Fisico"
                                subtitulo="{{turno.agenda.espacioFisico}}">
                    </plex-label>
                    <plex-label *ngIf="turno.nota" titulo="Nota" subtitulo="{{turno.nota}}"></plex-label>
                    <plex-label titulo="Organizacion" subtitulo="{{turno.agenda.organizacion.nombre}}"></plex-label>
                    <plex-label *ngIf="turno.agenda.profesionales[0]?.apellido" titulo="Profesional"
                                subtitulo="{{turno.agenda.profesionales[0].apellido}},{{turno.agenda.profesionales[0].nombre}}">
                    </plex-label>
                </plex-detail>
            </plex-panel>
        </plex-accordion>
    </plex-layout-sidebar>

</plex-layout>