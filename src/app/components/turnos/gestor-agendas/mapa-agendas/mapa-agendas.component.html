<plex-layout>
    <plex-layout-main>
        <plex-title titulo="Mapa Agendas">
            <plex-datetime *ngIf="verSemana" type="date" label="" [skipBy]="'week'" [(ngModel)]="diaInicio"
                           name="fechaSkip" (change)="cargarSemana()" required>
            </plex-datetime>

            <plex-datetime *ngIf="verDia" type="date" label="" [skipBy]="'days'" [(ngModel)]="diaInicio"
                           name="fechaSkip" required>
            </plex-datetime>

            <plex-datetime *ngIf="verMes" type="date" label="" [skipBy]="'month'" [(ngModel)]="diaInicio"
                           name="fechaSkip" required>
            </plex-datetime>

            <plex-button class="ml-2" type="info" label="Dia" (click)="visualizarDia()" tooltip="ver agendas del dia">
            </plex-button>

            <plex-button class="ml-2" type="info" disable="false" label="Semana" (click)="visualizarSemana()"
                         tooltip="ver agendas de la semana">
            </plex-button>

            <plex-button class="ml-2 mr-2" type="info" label="Mes" (click)="visualizarMes()"
                         tooltip="ver agendas del mes">
            </plex-button>
        </plex-title>

        <mapa-agenda-mes *ngIf="verMes" [fecha]="diaInicio" [dataF]="dataF" (diaDetalle)="visualizarDia($event)">
        </mapa-agenda-mes>

        <mapa-agenda-dia *ngIf="verDia" [fecha]="diaInicio" [dataF]="dataF">
        </mapa-agenda-dia>

        <fieldset *ngIf="!verMes && !verDia">
            <table class=" mapa-turnos table table-striped table-hover">
                <tr class="header">
                    <td width="50%">Horarios</td>
                    <td *ngFor="let dia of semana" class="text-center">
                        <small class="text-capitalize font-weight-bold">{{dia.nombre}}</small>
                        <br>
                        <small>{{dia.fecha | date:"dd/MM"}}</small>

                    </td>
                </tr>

                <ng-container *ngFor="let hora of horarios;let i=index">
                    <tr>
                        <td width="50" [attr.rowspan]="filasPorHorario.length">{{hora.hora}}:00</td>
                        <td *ngFor="let dia of semana">
                            <ng-container *ngIf="dia.horarios[i].intervalos[0].turnos.length>0">

                                <span *ngFor="let turno of dia.horarios[i].intervalos[0].turnos"
                                      [style.background]="turno.tipoPrestacion.color"
                                      tooltip="{{turno.tipoPrestacion.term}}">
                                    <plex-icon name="account-circle"></plex-icon>
                                </span>
                            </ng-container>
                        </td>
                    </tr>
                    <ng-container *ngFor="let fila of filasPorHorario; let aux= index;">
                        <tr *ngIf="aux>0">
                            <td *ngFor="let dia  of semana" class="">
                                <ng-container *ngIf="dia.horarios[i].intervalos[aux].turnos.length>0">
                                    <span *ngFor="let turno of dia.horarios[i].intervalos[aux].turnos"
                                          [style.background]="turno.tipoPrestacion.color"
                                          tooltip="{{turno.tipoPrestacion.term}}">
                                        <plex-icon name="account-circle"></plex-icon>
                                    </span>
                                </ng-container>
                            </td>
                        </tr>
                    </ng-container>
                </ng-container>
            </table>
        </fieldset>
    </plex-layout-main>
</plex-layout>