<plex-layout *ngIf="!showCrearAgenda" main="7">
    <plex-layout-main>
        <div *ngIf="autorizado && showReasignarTurno" class="plex-layout">

            <plex-title titulo="REASIGNACIÓN DE TURNOS">
                <plex-button type="danger" size="sm" (click)="cancelar()">Volver</plex-button>
            </plex-title>

            <plex-list [selectable]="false">
                <plex-item>
                    <plex-label *ngIf="agendaAReasignar.length === 0" class="flex-column" icon="calendar" size="xl"
                        direction="column" titulo="No quedan Turnos para reasignar en esta Agenda">
                    </plex-label>

                    <plex-icon name="calendario" type="info" size="xl"></plex-icon>

                    <plex-label titulo="Agenda"
                        subtitulo="{{agendaAReasignar.horaInicio | date: 'EEEE'}} {{agendaAReasignar.horaInicio | fecha}} 
                        de {{agendaAReasignar?.horaInicio|date:'HH:mm'}} a {{agendaAReasignar.horaFin | date: 'HH:mm'}} hs">
                    </plex-label>
                    <!-- <br> -->
                    <plex-label titulo="Prestaciones"
                        subtitulo="{{ agendaAReasignar.tipoPrestaciones | enumerar:['term']:'/' }}">
                    </plex-label>
                    <!-- <br> -->
                    <plex-label *ngIf="agendaAReasignar.profesionales?.length > 0" titulo="Profesionales"
                        subtitulo="{{ agendaAReasignar.profesionales | enumerar:['apellido','nombre'] }}">
                    </plex-label>

                    <plex-label *ngIf="agendaAReasignar.profesionales?.length === 0" titulo="Profesionales"
                        subtitulo="Sin profesionales asignados">
                    </plex-label>
                    <!-- <plex-wrapper>
                        <plex-bool label="Envío de SMS" class="pl-2 pr-2" type="slide" [(ngModel)]="smsActivo"
                            name="smsActivo"></plex-bool>
                        <plex-badge *ngIf="smsActivo" type="success">
                            Activo
                        </plex-badge>
                        <plex-badge *ngIf="!smsActivo" type="danger">
                            Inactivo
                        </plex-badge>
                    </plex-wrapper> -->
                </plex-item>
            </plex-list>


            <!-- <b>Agenda:</b> {{agendaAReasignar.horaInicio | date: 'EEEE'}}
                {{agendaAReasignar.horaInicio | fecha}}
                de {{agendaAReasignar?.horaInicio|date:'HH:mm'}} a {{agendaAReasignar.horaFin | date: 'HH:mm'}}
                hs
                <br>
                <b>Prestaciones:</b> {{ agendaAReasignar.tipoPrestaciones | enumerar:['term']:'/' }}
                <br>
                <b>Profesionales:</b>
                <span *ngIf="agendaAReasignar.profesionales?.length > 0">
                    <span></span>{{ agendaAReasignar.profesionales | enumerar:['apellido','nombre'] }}</span>
                <span *ngIf="agendaAReasignar.profesionales?.length === 0">Sin profesionales asignados</span>
                <br>
                <b>Envío de SMS:</b>
                <plex-bool class="pl-2 pr-2" type="slide" [(ngModel)]="smsActivo" name="smsActivo"></plex-bool>
                <plex-badge *ngIf="smsActivo" type="success">
                    Activo
                </plex-badge>
                <plex-badge *ngIf="!smsActivo" type="danger">
                    Inactivo
                </plex-badge> -->

            <!-- <fieldset class="pt-2"> -->
            <!--Turnos-->
            <plex-title titulo="TURNOS" size="sm"></plex-title>
            <plex-table *ngFor="let bloque of agendaAReasignar.bloques | sortBloques" class="table table-striped">
                <!-- <plex-table-columns>
                            </plex-table-columns> -->
                <tr *ngIf="bloque === agendaAReasignar.bloques[0]">
                    <th></th>
                    <th>Nombre</th>
                    <th>Tipo Turno</th>
                    <th>Prestación</th>
                    <th>Estado</th>
                </tr>
                <!-- <tbody> -->

                <tr *ngFor="let turno of bloque.turnos; let i=index" class="hover"
                    [ngClass]="{'bg-inverse text-white': estaSeleccionado(turno)}">
                    <!-- <ng-container *ngIf="turno?.reasignado?.siguiente; then reasignado else noReasignado">
                    </ng-container>
                        <ng-template #reasignado>
                    <ng-container -->
                    <!-- *ngIf="(agendaAReasignar.estado === 'suspendida' && turno.estado === 'asignado') || (turno.estado === 'suspendido' && turno.paciente && turno.paciente.id)"> -->
                    <ng-container *ngIf="turno.paciente?.id">
                        <td (click)="seleccionarTurno(turno, bloque, false)">
                            <i *ngIf="estaSeleccionado(turno)" class="mdi mdi-checkbox-marked"></i>
                            <i *ngIf="!estaSeleccionado(turno)" class="mdi mdi-checkbox-blank-outline"></i>
                        </td>
                        <td (click)="seleccionarTurno(turno, bloque, false)">
                            <!-- <strong *ngIf="turno">{{ turno.horaInicio | date: 'HH:mm' }}</strong> -->
                            <span *ngIf="turno && turno.paciente">{{ turno.paciente | nombre }} </span>
                            <small>
                                <span *ngIf="turno && turno.paciente && turno.paciente.documento !== ''">|
                                    DNI {{turno.paciente.documento}}</span>
                                <span *ngIf="turno && turno.paciente && turno.paciente.documento === ''">|
                                    Sin documento (temporal)</span>
                            </small>
                            <small>
                                <span
                                    *ngIf="turno?.paciente?.carpetaEfectores && turno.paciente.carpetaEfectores[0]?.nroCarpeta">
                                    <br /> Nro Carpeta
                                    <span *ngFor="let carpeta of turno.paciente.carpetaEfectores | slice:0:1;">{{
                                        carpeta.nroCarpeta }}</span>
                                </span>
                            </small>
                        </td>
                        <td (click)="seleccionarTurno(turno, bloque, false)">
                            <plex-badge type="info" *ngIf="turno?.tipoTurno">{{ turno.tipoTurno ?
                                tiposDeTurnos[turno.tipoTurno].nombre
                                : 'sin-tipo' }}
                            </plex-badge>
                        </td>
                        <td (click)="seleccionarTurno(turno, bloque, false)">
                            <!-- <br *ngIf="turno?.paciente && bloque.tipoPrestaciones.length > 1"> -->
                            <small>
                                <!-- <span
                                            *ngIf="turno?.paciente?.id && bloque.tipoPrestaciones.length>1">{{turno.tipoPrestacion.nombre}}
                                        </span> -->
                                <span *ngIf="turno?.tipoPrestacion?.nombre">
                                    {{turno.tipoPrestacion.nombre}}
                                </span>
                            </small>
                            <!-- <span *ngIf="turno?.estado === 'disponible'">Disponible</span>
                            <span [ngClass]="{'text-danger': turno.estado === 'turnoDoble'}"
                                *ngIf="turno?.estado === 'turnoDoble'">Turno Doble</span>
                            <span *ngIf="turno?.nota">
                                <i title="{{turno.nota}}"
                                    class="text-warning warning mdi mdi-message"></i>
                            </span> -->
                        </td>
                        <td (click)="seleccionarTurno(turno, bloque, false)">
                            <plex-badge *ngIf="turno?.reasignado?.siguiente" type="info badge-reasignar">
                                <plex-icon name="check"></plex-icon>
                                ya reasignado
                            </plex-badge>
                            <plex-badge *ngIf="!turno?.reasignado?.siguiente" type="warning badge-reasignar">
                                <plex-icon name="account-convert"></plex-icon>
                                sin reasignar
                            </plex-badge>
                        </td>
                    </ng-container>
                    <!-- </ng-template> -->

                    <!-- <ng-template #noReasignado>
                                    <ng-container
                                        *ngIf="(agendaAReasignar.estado === 'suspendida' && turno.estado === 'asignado') || (turno.estado === 'suspendido' && turno.paciente?.id)">
                                        <td (click)="seleccionarTurno(turno, bloque, false)">
                                            <strong *ngIf="turno">{{ turno.horaInicio | date: 'HH:mm' }}</strong>
                                        </td>
                                        <td (click)="seleccionarTurno(turno, bloque, false)">
                                            <span *ngIf="turno && turno.paciente">{{ turno.paciente | nombre }}
                                            </span>
                                            <small>
                                                <span
                                                    *ngIf="turno && turno.paciente && turno.paciente.documento !== ''">|
                                                    DNI {{turno.paciente.documento|number}}</span>
                                                <span
                                                    *ngIf="turno && turno.paciente && turno.paciente.documento === ''">|
                                                    Sin documento (temporal)</span>
                                            </small>
                                            <small>
                                                <span
                                                    *ngIf="turno?.paciente?.carpetaEfectores && turno.paciente.carpetaEfectores.length>0">
                                                    | Nro Carpeta
                                                    <span
                                                        *ngFor="let carpeta of turno.paciente.carpetaEfectores | slice:0:1;">{{carpeta.nroCarpeta}}</span>
                                                </span>
                                                <br>
                                                <span *ngIf="turno?.tipoTurno">Tipo de turno: {{ turno.tipoTurno ?
                                                    tiposDeTurnos[turno.tipoTurno].nombre
                                                    : 'sin-tipo' }}</span>
                                            </small>

                                            <br *ngIf="turno && turno.paciente && bloque.tipoPrestaciones.length>1">
                                            <small>
                                                <span
                                                    *ngIf="turno && turno.paciente && bloque.tipoPrestaciones.length>1">{{turno.tipoPrestacion.nombre}}</span>
                                            </small>
                                            <span
                                                [ngClass]="{'text-danger': bloque.turnos[i+1].estado === 'turnoDoble'}"
                                                *ngIf="bloque.turnos[i+1] && bloque.turnos[i+1].estado === 'turnoDoble'">Turno
                                                Doble</span>
                                            <span *ngIf="turno && turno.nota">
                                                <i title="{{turno.nota}}"
                                                    class="text-warning warning mdi mdi-message"></i>
                                            </span>
                                        </td>
                                        <td (click)="seleccionarTurno(turno, bloque, false)">
                                            <plex-badge type="warning badge-reasignar">
                                                <plex-icon name="account-convert"></plex-icon>
                                                sin reasignar
                                            </plex-badge>
                                        </td>
                                    </ng-container>
                                </ng-template> -->
                </tr>
            </plex-table>

            <!-- </fieldset> -->
        </div>

        <!-- </plex-box>
        </form> -->
        <!-- <footer *ngIf="showReasignarTurno">
            <div class="row">
                <div class="col">
                    <plex-button type="primary" label="Gestor de Agendas" (click)="cancelar()"></plex-button>
                </div>
            </div>
        </footer> -->

    </plex-layout-main>
    <!-- </div> -->
    <!-- </div> -->
    <!-- <div class="col-6">
                <plex-box>
                    <reasignar-turno-agendas [agendasSimilares]="agendasSimilares"
                        [turnoSeleccionado]="turnosSeleccionados[0]" [agendaAReasignar]="agendaAReasignar"
                        [datosAgenda]="datosAgenda" [agendaDestino]="agendaDestino" [smsStatus]="smsActivo"
                        (turnoReasignadoEmit)="reasignacionManualAgendas($event)">
                    </reasignar-turno-agendas>
                </plex-box>
            </div> -->
    <!-- </div> -->
    <!-- <div class="col-6"> -->

    <plex-layout-sidebar type="invert" *ngIf="!showCrearAgenda">
        <!-- <plex-box> -->
        <reasignar-turno-agendas [agendasSimilares]="agendasSimilares" [turnoSeleccionado]="turnosSeleccionados[0]"
            [agendaAReasignar]="agendaAReasignar" [datosAgenda]="datosAgenda" [agendaDestino]="agendaDestino"
            [smsStatus]="smsActivo" (turnoReasignadoEmit)="reasignacionManualAgendas($event)"
            (crearAgendaEmit)="crearAgenda()">
        </reasignar-turno-agendas>
        <!-- </plex-box> -->
    </plex-layout-sidebar>

    <!-- <plex-layout-footer *ngIf="showReasignarTurno">
        <plex-button position="left" type="primary" label="Gestor de Agendas" (click)="cancelar()"></plex-button>
    </plex-layout-footer> -->

    <permisos *ngIf="!autorizado" [permisos]="permisosRequeridos" [botonCancelar]="true" (cancelarEmit)="cancelar()">
    </permisos>

</plex-layout>

<planificar-agenda *ngIf="showCrearAgenda" (volverAlGestor)="crearAgenda()">
</planificar-agenda>