<ng-container *ngIf="autorizado && agendaAReasignar">
    <plex-title *ngIf="turnoSeleccionado?.reasignado?.siguiente" titulo="DETALLES DE LA REASIGNACIÓN"></plex-title>
    <plex-title *ngIf="!turnoSeleccionado?.reasignado?.siguiente"
                titulo="SELECCIÓN DE TURNO PARA REASIGNACIÓN"></plex-title>
    <!-- Hay turno? -->
    <ng-container *ngIf="turnoSeleccionado?.paciente">
        <plex-list [selectable]="false">
            <plex-item>
                <plex-icon name="calendario-fecha" size="xl" type="info"></plex-icon>
                <plex-label *ngIf="turnoSeleccionado.paciente.documento !== ''" titulo="Paciente"
                            subtitulo="{{ turnoSeleccionado.paciente | nombre }} | DNI: {{ turnoSeleccionado.paciente.documento | number }}"
                            size="lg">
                </plex-label>
                <plex-label *ngIf="turnoSeleccionado.paciente.documento === ''" titulo="Paciente"
                            subtitulo="{{ turnoSeleccionado.paciente | nombre }} | Sin documento" size="lg">
                </plex-label>
                <plex-label *ngIf="turnoSeleccionado.paciente.telefono || turnoSeleccionado?.paciente?.obraSocial?.nombre"
                            titulo="Datos de contacto" size="lg"
                            subtitulo="Teléfono: {{ turnoSeleccionado?.paciente?.telefono }} - Obra Social: {{ turnoSeleccionado?.paciente?.obraSocial?.nombre }}">
                </plex-label>
            </plex-item>
        </plex-list>
    </ng-container>

    <br />

    <!-- Turno ya Reasignado. -->
    <ng-container *ngIf="turnoSeleccionado?.reasignado?.siguiente">
        <plex-list [selectable]="false">
            <plex-title titulo="Este turno ya fue reasignado" size="sm"></plex-title>
            <plex-item>
                <plex-icon name="calendario" size="lg" type="warning"></plex-icon>
                <plex-label>Agenda y Turno Origen</plex-label>
                <plex-label *ngIf="agendaAReasignar?.horaInicio" titulo="{{agendaAReasignar?.horaInicio | date: 'EEEE' |
                            uppercase }} {{agendaAReasignar?.horaInicio | fecha}} de {{agendaAReasignar?.horaInicio |
                            date: 'HH:mm' }} a {{agendaAReasignar?.horaFin | date: 'HH:mm' }} hs"
                            subtitulo="Turno: {{turnoSeleccionado?.horaInicio | date: 'HH:mm' }} hs">
                </plex-label>
                <plex-label *ngIf="agendaAReasignar?.profesionales?.length"
                            titulo="{{ agendaAReasignar?.profesionales | enumerar:['apellido', 'nombre'] }}"
                            subtitulo="Equipo de Salud">
                </plex-label>
                <plex-label *ngIf="agendaAReasignar?.profesionales?.length === 0" titulo="No asignado"
                            subtitulo="Equipo de Salud">
                </plex-label>
            </plex-item>
            <plex-item>
                <plex-icon name="calendario-tilde" size="lg" type="success"></plex-icon>
                <plex-label>Agenda y Turno Destino</plex-label>
                <plex-label *ngIf="agendaDestino?.agenda?.horaInicio" titulo="{{agendaDestino?.agenda?.horaInicio | date: 'EEEE' |
                            uppercase }} {{ agendaDestino?.agenda?.horaInicio | fecha}} de {{ agendaDestino?.agenda.horaInicio |
                            date: 'HH:mm' }} a {{ agendaDestino?.agenda?.horaFin | date:'HH:mm' }} hs"
                            subtitulo="Turno: {{agendaDestino?.turno?.horaInicio | date: 'HH:mm' }} hs">
                </plex-label>
                <plex-label *ngIf="agendaDestino?.agenda?.profesionales?.length"
                            titulo="{{ agendaDestino?.agenda?.profesionales | enumerar:['apellido', 'nombre'] }}"
                            subtitulo="Equipo de Salud">
                </plex-label>
                <plex-label *ngIf="agendaDestino?.agenda?.profesionales.length === 0" titulo="No asignado"
                            subtitulo="Equipo de Salud">
                </plex-label>
            </plex-item>
        </plex-list>
    </ng-container>
    <!-- El turno aun no fue reasignado? -->
    <ng-container *ngIf="!turnoSeleccionado?.reasignado?.siguiente">
        <!-- Hay agendas similares? -->
        <ng-container *ngIf="(!agendasSimilares || agendasSimilares?.length===0) && turnoSeleccionado">
            <div justify="center" class="col-12">
                <plex-label size="lg" icon="zoom" type="info">
                </plex-label>
            </div>
            <div justify="center">
                <plex-label size="lg" direction="column">No hay agendas disponibles. Para agregar click aquí
                    <plex-button class="comment" type="link" size="lg" (click)="crearAgenda(turno)">
                        CREAR NUEVA AGENDA
                    </plex-button>
                </plex-label>
            </div>
        </ng-container>

        <ng-container *ngIf="!turnoSeleccionado">
            <div class="h-50 d-flex justify-content-center align-items-center">
                <plex-label direction="column" icon="turno-mas" direction="column"
                            titulo="Seleccione un turno para ver agendas candidatas a reasignar"
                            subtitulo="o Seleccione un turno ya reasignado para ver más detalles">
                </plex-label>
            </div>
        </ng-container>

        <ng-container *ngIf="mostrarAgendasSimilares()">
            <plex-title size="md" titulo="Agendas"></plex-title>

            <plex-list class="col-12">
                <plex-heading [selectable]="false" sticky="true">
                    <plex-label class="head-tit"></plex-label>
                    <plex-label class="head-tit">Fecha</plex-label>
                    <plex-label class="head-tit">Horario</plex-label>
                    <plex-label class="">Equipo de Salud</plex-label>
                </plex-heading>

                <ng-container *ngFor="let agenda of agendasSimilares; let indiceAgenda = index"
                              (change)="changeCollapse($event)" class="col-12">
                    <plex-item (click)="seleccionarAgenda(indiceAgenda)">
                        <i *ngIf="estaSeleccionada(agenda)"><plex-icon name="checkbox-marked" size="md"></plex-icon></i>
                        <i *ngIf="!estaSeleccionada(agenda)"><plex-icon name="checkbox-blank-outline"
                                       size="md"></plex-icon></i>
                        <plex-label case="capitalize"
                                    titulo="{{ agenda.horaInicio | date: 'EEEE' }} {{ agenda.horaInicio | date:'dd/MM/yyyy' }}">
                        </plex-label>
                        <plex-label
                                    titulo="{{ agenda.horaInicio | date:'HH:mm' }}-{{ agenda.horaFin | date: 'HH:mm' }} hs">
                        </plex-label>
                        <plex-label *ngIf="agenda.profesionales?.length" size="md"
                                    titulo="{{ agenda.profesionales | enumerar:['apellido','nombre']}}">
                        </plex-label>
                        <plex-label *ngIf="!agenda.profesionales || agenda.profesionales?.length === 0">(no asignado)
                        </plex-label>
                        <plex-button *ngIf="estaSeleccionada(agenda)" icon="chevron-up" size="lg"
                                     type="link"></plex-button>
                        <plex-button *ngIf="!estaSeleccionada(agenda)" icon="chevron-down" size="lg"
                                     type="link"></plex-button>
                    </plex-item>

                    <div *ngIf="estaSeleccionada(agenda)">
                        <div *ngFor="let bloque of agenda.bloques; let indBloque = index">
                            <ng-container *ngIf="existePrestacion(bloque, turnoSeleccionado.tipoPrestacion.id)">

                                <plex-title *ngIf="indBloque === 0" size="sm" titulo="Seleccione horario">
                                    <plex-button type="success" size="sm" icon="check"
                                                 [disabled]="!seleccionoHorario || !estaSeleccionada(agenda)"
                                                 tooltip="Confirmar" tooltipPosition="left"
                                                 (click)="reasignarTurno(indiceTurno, indiceBloque, indiceAgenda)"></plex-button>
                                </plex-title>
                                <div *ngIf="existePrestacion(bloque, turnoSeleccionado.tipoPrestacion.id)">
                                    <div *ngIf="bloque.descripcion && i === 0">
                                        Bloque
                                        <span>{{bloque.descripcion}}</span>
                                    </div>

                                    <plex-grid *ngIf="tieneTurnos(bloque)" type="full" size="sm">
                                        <ng-container *ngFor="let turno of bloque.turnos; let i=index">
                                            <div *ngIf="mostrarHorarioTurno(agenda, turno)">
                                                <plex-card type="dark" mode="filled" size="xs" class="hover"
                                                           [selectable]="true"
                                                           [selected]="horarioSeleccionado(i, indBloque, indiceAgenda)"
                                                           (click)="seleccionarCandidata(i, indBloque, indiceAgenda)"
                                                           [ngClass]="{'disabled' : !turnoSeleccionable(bloque, turno, i)}">
                                                    <plex-label size="md" direction="column"
                                                                titulo="{{turno.horaInicio | date: 'HH:mm'}}hs">
                                                    </plex-label>
                                                </plex-card>
                                            </div>
                                        </ng-container>
                                    </plex-grid>
                                    <br />
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>
            </plex-list>
        </ng-container>
    </ng-container>

    <!-- Muestra modal al reasignar el turno. -->
    <plex-modal *ngIf="reasignado" size="sm" #modal [startOpen]="true" [allowEscClose]="false"
                [allowBackdropClose]="false">
        <plex-icon name="account-check" type="success mt-5 mb-2"></plex-icon>
        <plex-modal-subtitle type="success" class="font-subtitle text-muted text-center">El turno fué reasignado
            exitosamente</plex-modal-subtitle>
        <br>
        <main>
            <section class="h-50">
                <plex-title titulo="Datos de la reasignación"></plex-title>
                <br>
                <plex-item>
                    <plex-icon name="calendario" size="lg" type="info"></plex-icon>
                    <plex-label *ngIf="turnoSel?.horaInicio"
                                titulo="{{ turnoSel.horaInicio | date: 'EEEE' | uppercase }} {{ turnoSel.horaInicio | fecha }}"
                                subtitulo="{{ turnoSel.horaInicio | date: 'HH:mm' }} Hs.">
                    </plex-label>
                </plex-item>
                <plex-item>
                    <plex-icon name="paciente" size="lg" type="info"></plex-icon>
                    <plex-label *ngIf="turnoSeleccionado.paciente.documento !== ''"
                                titulo="{{ turnoSeleccionado.paciente | nombre }}"
                                subtitulo="DNI: {{ turnoSeleccionado.paciente.documento | number }}">
                    </plex-label>
                </plex-item>
                <plex-item>
                    <plex-icon name="mano-corazon" size="lg" type="info"></plex-icon>
                    <plex-label titulo="{{ agendaDestino?.agenda?.tipoPrestaciones | enumerar:['term'] }}"
                                subtitulo="Prestaciones" case="capitalize">
                    </plex-label>
                </plex-item>
                <plex-item>
                    <plex-icon name="medico" size="lg" type="info"></plex-icon>
                    <plex-label titulo="{{ agendaDestino?.agenda?.profesionales | enumerar:['apellido', 'nombre'] }}"
                                subtitulo="Equipo de Salud" case="capitalize">
                    </plex-label>
                    <plex-label *ngIf="agendaDestino?.agenda?.profesionales?.length === 0">Equipo de Salud no asignado
                    </plex-label>
                </plex-item>
            </section>
        </main>
        <plex-button class="mb-4" modal center type="info" (click)="cerrarModal()">
            Aceptar
        </plex-button>
    </plex-modal>

</ng-container>