<plex-title titulo="REGISTROS DEL TURNO">
    <plex-help class="mr-1" type="help" icon="information-variant" titulo="Detalle de agenda"
               tooltip="Detalle de agenda" tooltipPosition="left">
        <div class="container mb-4">
            <div class="row">
                <div class="col-12">
                    <label>Creada por </label> {{ agenda.createdBy | nombre }}
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label>Fecha</label> {{ agenda.horaInicio | date: 'EEE' | uppercase }} {{
                    agenda.horaInicio
                    | date:
                    'dd/MM/yyyy'}}, {{ agenda.horaInicio | date: 'HH:mm'}} a {{ agenda.horaFin |
                    date:
                    'HH:mm'}} hs
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label>Tipos de prestación</label>
                    <div *ngFor="let tipoPrestacion of agenda.tipoPrestaciones">
                        {{tipoPrestacion.nombre}}</div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label>Equipo de Salud</label>
                    <span *ngIf="agenda.profesionales?.length == 0" class="text-danger">Equipo de
                        Salud
                        no
                        asignado</span>
                    <ng-container *ngIf="agenda.profesionales">
                        <div *ngFor="let profesional of agenda.profesionales">
                            {{profesional | nombre}}
                        </div>
                    </ng-container>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label>Espacio físico</label>
                    <span *ngIf="agenda.espacioFisico?.nombre || agenda.otroEspacioFisico?.nombre">{{agenda
                        | espacioFisico}}</span>
                    <span *ngIf="!agenda.espacioFisico?.nombre && !agenda.otroEspacioFisico?.nombre"
                          class="text-danger">Espacio físico no
                        asignado</span>
                </div>
            </div>
            <div *ngIf="agenda.dinamica" class="row">
                <div class="col-12">
                    <label>Cupos disponibles</label>
                    <span *ngIf="agenda.cupo > -1">{{agenda.cupo}}</span>
                    <span *ngIf="agenda.cupo == -1">Sin límite</span>
                </div>
            </div>
            <div *ngIf="agenda.link" class="row">
                <div class="col-12">
                    <label>Link agenda virtual</label>
                    <a href="{{agenda.link}}" target="_blank">{{agenda.link}}</a>
                </div>
            </div>
        </div>
    </plex-help>
    <plex-button class="mr-1" position="right" type="danger" label="" icon="close" size="sm" tooltip="Cerrar"
                 (click)="cerrarSidebarRevision()"></plex-button>
</plex-title>

<plex-list [selectable]="false">
    <plex-item>
        <plex-badge [type]="estadoAgenda(agenda.estado, 'c')">{{estadoAgenda(agenda.estado, 'n')}}</plex-badge>
        <plex-icon name="calendarios" left [type]="estadoAgenda(agenda.estado, 'c')" size="xl"></plex-icon>
        <plex-label size="md" case="capitalize"
                    titulo="{{ agenda.horaInicio | date: 'EEEE' | uppercase }} {{agenda.horaInicio | date: 'dd/MM/yyyy'}}"
                    subtitulo="{{ agenda.horaInicio | date: 'HH:mm'}} a {{ agenda.horaFin | date: 'HH:mm'}} hs">
        </plex-label>
        <plex-label size="sm" case="capitalize" titulo="Prestación"
                    subtitulo="{{agenda.tipoPrestaciones | enumerar:['nombre']}}">
        </plex-label>
        <plex-label *ngIf="agenda.profesionales?.length" size="sm" case="capitalize" titulo="Equipo de Salud"
                    subtitulo="{{agenda.profesionales | enumerar:['apellido','nombre']}}">
        </plex-label>
        <plex-label *ngIf="agenda.profesionales?.length === 0" size="sm" case="capitalize" titulo="Equipo de Salud"
                    subtitulo="Equipo de Salud no asignado">
        </plex-label>
    </plex-item>
</plex-list>

<plex-title *ngIf="!showSobreturno && !pacientesSearch" titulo="Revisión" size="sm">
    <plex-button *ngIf="!agenda.dinamica && agenda.nominalizada && !pacientesSearch && !showCodificacion" type="primary"
                 tooltip="Agregar Sobreturno" tooltipPosition="left" icon="account-plus" size="sm" class="mr-1"
                 (click)="agregarSobreturno()">
    </plex-button>
    <plex-button *ngIf="agenda.dinamica && agenda.cupo" type="primary" tooltip="Agregar paciente" tooltipPosition="left"
                 icon="account-plus" size="sm" class="mr-1" (click)="agregarPaciente()">
    </plex-button>
</plex-title>

<ng-container *ngIf="agenda && !showSobreturno && !showCodificacion && !pacientesSearch">
    <plex-table *ngFor="let bloque of agenda.bloques" class="tabla-turnos turnos">
        <tr *ngFor="let turno of bloque.turnos; let i=index" [class.selectable]="selectable"
            [class.selected]="estaSeleccionado(turno)">
            <td class="col-1 hover" (click)="seleccionarTurno(turno, bloque)">
                <ng-container *ngIf="turno.estado !== 'turnoDoble'">
                    <i *ngIf="indexSeleccionado(turno._id)" class="adi adi-checkbox-marked"></i>
                    <i *ngIf="!indexSeleccionado(turno._id)" class="adi adi-checkbox-blank-outline"></i>
                </ng-container>
            </td>
            <td class="col-9 {{class(turno.estado)}}" (click)="seleccionarTurno(turno, bloque)">
                <span *ngIf="turno && turno.estado === 'disponible'">
                    <plex-badge size="sm" type="success">Turno Libre</plex-badge><br />
                </span>
                <strong *ngIf="turno">{{ turno.horaInicio | date: 'HH:mm' }}</strong>
                <span *ngIf="turno.paciente && turno.paciente.id"> | {{ turno.paciente | nombre }}
                </span>
                <span *ngIf="turno.paciente && turno.paciente.id && turno.paciente.documento !== ''">
                    <span *ngIf="turno.paciente.documento !== ''">- DNI: {{ turno.paciente.documento |
                        number }}</span>
                </span>
                <span *ngIf="turno.paciente && turno.paciente.id && turno.paciente.documento === ''">
                    <span>- Sin documento (temporal)</span>
                </span>
                <span [ngClass]="{'text-danger': turno.estado === 'turnoDoble'}"
                      *ngIf="turno && turno.estado === 'turnoDoble'"> - Turno
                    Doble</span>
                <span [ngClass]="{'text-danger': turno.estado === 'suspendido'}"
                      *ngIf="turno && turno.estado === 'suspendido'"> - Suspendido</span>
                <span *ngIf="turno && turno.nota">
                    <i tooltip="{{turno.nota}}" class="text-warning warning adi adi-message"></i>
                </span>
                <span [ngClass]="{'text-warning': true}" *ngIf="turno?.asistencia && turno?.asistencia == 'asistio' &&
                    !turno?.diagnostico?.codificaciones[0]?.codificacionAuditoria?.codigo &&
                    !turno?.diagnostico?.codificaciones[0]?.codificacionProfesional?.snomed?.term"> - Asistencia
                    Verificada</span>
                <span [ngClass]="{'text-success': true}" *ngIf="isRegistradoProfesional(turno) &&
                    !isAuditado(turno)"> - Registrado por Profesional</span>
                <span [ngClass]="{'text-success': true}" *ngIf="isAuditado(turno)"> - Auditado</span>
                <br><small><span [ngClass]="{'text-info': true}" *ngIf="turno.usuarioDacion">Asignado por
                        {{turno.usuarioDacion.nombreCompleto}}</span></small>
            </td>

            <!-- ACCIONES -->
            <td class="col-2 td_flex">

                <plex-badge *ngIf="turno?.paciente?.id && turno.estado !== 'disponible' && turno.asistencia === 'asistio'"
                            size="sm" type="success" tooltip="Asistió">
                    <plex-icon size="sm" name="account-check"></plex-icon>
                </plex-badge>

                <plex-badge *ngIf="turno?.paciente?.id && turno.estado !== 'disponible' && turno.asistencia === 'noAsistio'"
                            size="sm" type="danger" tooltip="No asistió">
                    <plex-icon size="sm" name="account-remove"></plex-icon>
                </plex-badge>

                <plex-badge *ngIf="turno?.paciente?.id && turno.estado !== 'disponible' && turno.asistencia === 'sinDatos'"
                            size="sm" type="warning" tooltip="Sin datos">
                    <plex-icon size="sm" name="account-off"></plex-icon>
                </plex-badge>

                <ng-container *ngIf="turno.estado !== 'turnoDoble' && indexSeleccionado(turno._id)">

                    <ng-container *ngIf="turno.estado !== 'disponible' && turno.asistencia">
                        &nbsp;
                    </ng-container>

                    <plex-button *ngIf="turno.estado === 'disponible'" type="primary" tooltip="Agregar paciente"
                                 tooltipPosition="left" icon="account-plus" size="sm" (click)="buscarPaciente()">
                    </plex-button>

                    <!-- ASISTENCIA -->

                    <plex-button *ngIf="turno?.paciente?.id && turno.estado !== 'disponible' && turno.asistencia && !showModifAsistencia"
                                 type="warning" tooltip="Modificar asistencia" tooltipPosition="left" icon="undo"
                                 size="sm" (click)="modificarAsistencia()">
                    </plex-button>

                    <plex-dropdown *ngIf="turno?.paciente?.id && (!turno.asistencia || showModifAsistencia)" #drop
                                   icon="account-check" size="sm" type="success" [items]="itemsDropdown" right="true"
                                   (onOpen)="setDropDown(drop)" tooltip="Asistencia" tooltipPosition="left">
                    </plex-dropdown>

                    &nbsp;

                    <!-- CODIFICACION -->
                    <plex-button *ngIf="turno?.paciente?.id && turno.estado !== 'disponible' && turno.asistencia === 'asistio'"
                                 type="primary" tooltip="Codificar" tooltipPosition="left" icon="adi adi-pc" size="sm"
                                 (click)="codificar()">
                    </plex-button>

                </ng-container>
            </td>
        </tr>
    </plex-table>

    <!-- SOBRETURNOS -->
    <plex-table *ngIf="agenda" class="tabla-turnos sobreturnos">
        <plex-title *ngIf="agenda.sobreturnos.length > 0" titulo="Sobreturnos" size="sm"></plex-title>
        <tr *ngFor="let sobreturno of agenda.sobreturnos; let i=index" [class.selectable]="selectable"
            [class.selected]="estaSeleccionado(sobreturno)">
            <td class="col-1 hover" (click)="seleccionarTurno(sobreturno, -1)">
                <i *ngIf="indexSeleccionado(sobreturno._id)" class="adi adi-checkbox-marked"></i>
                <i *ngIf="!indexSeleccionado(sobreturno._id)" class="adi adi-checkbox-blank-outline"></i>
            </td>
            <td class="col-9 hover" (click)="seleccionarTurno(sobreturno, -1)">
                <strong *ngIf="sobreturno">{{ sobreturno.horaInicio | date: 'HH:mm' }}</strong>
                &nbsp;
                <span *ngIf="sobreturno.paciente && sobreturno.paciente.id">| {{ sobreturno.paciente |
                    nombre }} </span>
                <small>
                    <span *ngIf="sobreturno.paciente && sobreturno.paciente.id && sobreturno.paciente.documento !== ''">
                        -
                        DNI: {{ sobreturno.paciente.documento }}</span>
                    <span *ngIf="sobreturno.paciente && sobreturno.paciente.id && sobreturno.paciente.documento === ''"
                          class="text-danger">- DNI: Sin documento (temporal)</span>
                </small>
                <span [ngClass]="{'text-danger': sobreturno.estado === 'suspendido'}"
                      *ngIf="sobreturno && sobreturno.estado === 'suspendido'"> - Suspendido</span>
                <span *ngIf="sobreturno && sobreturno.nota">
                    <i tooltip="{{sobreturno.nota}}" class="text-warning warning adi adi-message"></i>
                </span>
                <span [ngClass]="{'text-warning': true}" *ngIf="sobreturno?.asistencia && sobreturno?.asistencia == 'asistio' &&
                    !sobreturno?.diagnostico?.codificaciones[0]?.codificacionAuditoria?.codigo"> - Asistencia
                    Verificada</span>
                <span [ngClass]="{'text-success': true}"
                      *ngIf="sobreturno?.paciente?.id && (sobreturno?.diagnostico?.codificaciones[0]?.codificacionAuditoria?.codigo || (sobreturno?.asistencia && sobreturno.asistencia =='noAsistio'|| sobreturno.asistencia=='sinDatos'))">
                    -
                    Auditado</span>
            </td>
            <!-- ACCIONES SOBRETURNO -->
            <td class="col-2 td_flex">
                <!-- ASISTENCIA -->
                <plex-badge *ngIf="sobreturno?.paciente?.id && sobreturno.estado !== 'disponible' && sobreturno.asistencia === 'asistio'"
                            size="sm" type="success" tooltip="Asistió">
                    <plex-icon size="sm" name="account-check"></plex-icon>
                </plex-badge>

                <plex-badge *ngIf="sobreturno?.paciente?.id && sobreturno.estado !== 'disponible' && sobreturno.asistencia === 'noAsistio'"
                            size="sm" type="danger" tooltip="No asistió">
                    <plex-icon size="sm" name="account-remove"></plex-icon>
                </plex-badge>

                <plex-badge *ngIf="sobreturno?.paciente?.id && sobreturno.estado !== 'disponible' && sobreturno.asistencia === 'sinDatos'"
                            size="sm" type="warning" tooltip="Sin datos">
                    <plex-icon size="sm" name="account-off"></plex-icon>
                </plex-badge>

                &nbsp;

                <ng-container *ngIf="indexSeleccionado(sobreturno._id)">
                    <plex-button *ngIf="sobreturno?.paciente?.id && sobreturno.estado !== 'disponible' && sobreturno.asistencia && !showModifAsistencia"
                                 type="warning" tooltip="Modificar asistencia" tooltipPosition="left" icon="undo"
                                 size="sm" (click)="modificarAsistencia()">
                    </plex-button>

                    <plex-dropdown *ngIf="sobreturno?.paciente?.id && (!sobreturno.asistencia || showModifAsistencia)"
                                   #drop icon="account-check" size="sm" type="success" [items]="itemsDropdown"
                                   right="true" (onOpen)="setDropDown(drop)" tooltip="Asistencia"
                                   tooltipPosition="left">
                    </plex-dropdown>

                    &nbsp;
                    <plex-button class="pr-1"
                                 *ngIf="sobreturno?.paciente?.id && sobreturno.estado !== 'disponible' && sobreturno.asistencia === 'asistio'"
                                 type="primary" tooltip="Codificar" tooltipPosition="left" icon="adi adi-pc" size="sm"
                                 (click)="codificar(sobreturno, -1)">
                    </plex-button>
                </ng-container>
            </td>
        </tr>
    </plex-table>
    <!-- /SOBRETURNOS -->

</ng-container>

<!-- AGREGAR SOBRETURNO -->
<ng-container *ngIf="showSobreturno">
    <sobreturno [agenda]="agenda" (cerrarSobreturno)="cerrarSobreturno()"></sobreturno>
</ng-container>

<!-- AGREGAR PACIENTE (Agenda Dinámica) -->
<ng-container *ngIf="showAddPaciente">
    <agregar-paciente [agenda]="agenda" (cerrar)="cerrarPaciente()">
    </agregar-paciente>
</ng-container>

<!-- BUSCAR PACIENTE (Turno Libre) -->
<ng-container
              *ngIf="turnoSeleccionado && turnoSeleccionado.estado == 'disponible' && pacientesSearch && agenda.nominalizada">
    <plex-title size="md" titulo="Agregar Paciente">
        <plex-button icon="arrow-left" tooltip="Volver" class="btn btn-sm" type="primary" tooltipPosition="left"
                     (click)="cerrarBuscarPaciente()" size="sm">
        </plex-button>
    </plex-title>
    <plex-table>
        <tr>
            <td>
                <strong>{{ turnoSeleccionado.horaInicio | date: 'HH:mm' }}</strong> Hs.
                &nbsp;
                <plex-badge *ngIf="!paciente?.id" class="mr-1" size="sm" type="success">
                    TURNO LIBRE
                </plex-badge>
                <ng-container *ngIf="paciente?.id">
                    <span>{{ paciente | nombre }}</span>
                    <small>
                        <span *ngIf="paciente.documento"> | DNI: {{ paciente?.documento | number }}</span>
                    </small>
                </ng-container>
            </td>
            <td>
                <ng-container *ngIf="paciente?.id && bloqueSeleccionado.tipoPrestaciones.length > 1">
                    <plex-select [(ngModel)]="turnoTipoPrestacion" name="tipoPrestacion" label="Tipo de prestación"
                                 [data]="agenda.tipoPrestaciones" placeholder="Seleccione el tipo de prestación"
                                 [required]="true">
                    </plex-select>
                </ng-container>
            </td>
            <td>
                <ng-container *ngIf="paciente?.id && !existeCodificacionProfesional">
                    <plex-dropdown #drop icon="account-check" size="sm" type="success" [items]="itemsDropdown"
                                   right="true" (onOpen)="setDropDown(drop)" tooltip="Asistencia" tooltipPosition="top">
                    </plex-dropdown>
                </ng-container>
            </td>
        </tr>
        <tr *ngIf="!paciente?.id">
            <td colspan="3">
                <paciente-buscar (searchStart)="searchStart()" (searchEnd)="searchEnd($event.pacientes, $event.scan)"
                                 (searchClear)="onSearchClear()">
                </paciente-buscar>
                <plex-loader *ngIf="loading" type="ball-pulse"></plex-loader>
                <paciente-listado *ngIf="resultadoBusqueda && resultadoBusqueda.length" [offset]="150"
                                  [pacientes]="resultadoBusqueda" (selected)="onSelect($event)">
                </paciente-listado>
                <div *ngIf="resultadoBusqueda && !resultadoBusqueda.length && !loading" class="alert">
                    <i class="adi adi-account-alert"></i> No se encontró ningún paciente.
                </div>
            </td>
        </tr>
    </plex-table>
</ng-container>

<!-- CODIFICACION -->
<ng-container *ngIf="showCodificacion">
    <plex-table>
        <tr>
            <td>
                <strong>{{ turnoSeleccionado.horaInicio | date: 'HH:mm' }}</strong>
            </td>
            <td>
                <span *ngIf="turnoSeleccionado.paciente && turnoSeleccionado.paciente.id">{{ turnoSeleccionado.paciente
                    | nombre }}
                </span>
                <small
                       *ngIf="turnoSeleccionado.paciente && turnoSeleccionado.paciente.id && turnoSeleccionado.paciente.documento !== ''">
                    <span *ngIf="turnoSeleccionado.paciente.documento !== ''">| DNI: {{
                        turnoSeleccionado.paciente.documento |
                        number }}</span>
                </small>
                <small
                       *ngIf="turnoSeleccionado.paciente && turnoSeleccionado.paciente.id && turnoSeleccionado.paciente.documento === ''">
                    <span>| Sin documento (temporal)</span>
                </small>
                <small>
                    <span *ngIf="turnoSeleccionado?.paciente?.carpetaEfectores?.length">
                        <span *ngFor="let carpeta of turnoSeleccionado.paciente.carpetaEfectores">
                            <span *ngIf="carpeta.organizacion?._id == idOrganizacion">
                                | Nro Carpeta {{carpeta.nroCarpeta}}
                            </span>
                        </span>
                    </span>
                </small>

                <span [ngClass]="{'text-warning': true}" *ngIf="turnoSeleccionado?.asistencia && turnoSeleccionado?.asistencia == 'asistio' &&
                           !turnoSeleccionado?.diagnostico?.codificaciones[0]?.codificacionAuditoria?.codigo &&
                           !turnoSeleccionado?.diagnostico?.codificaciones[0]?.codificacionProfesional?.snomed?.term">
                    -
                    Asistencia Verificada</span>
                <span [ngClass]="{'text-success': true}"
                      *ngIf="isRegistradoProfesional(turnoSeleccionado) && !isAuditado(turnoSeleccionado)"> -
                    Registrado por Profesional</span>
                <span [ngClass]="{'text-success': true}" *ngIf="isAuditado(turnoSeleccionado)"> - Auditado</span>
                <br><small><span [ngClass]="{'text-info': true}" *ngIf="turnoSeleccionado.usuarioDacion">Asignado por
                        {{turnoSeleccionado.usuarioDacion.nombreCompleto}}</span></small>
            </td>
        </tr>
    </plex-table>

    <div *ngIf="!showReparo" class="mt-4">
        <plex-title titulo="Codificación" size="sm">
            <plex-button *ngIf="puedeAprobar()" class="btn btn-sm pr-1" type="success" icon="check" tooltip="Aprobar"
                         size="sm" (click)="aprobar()">
            </plex-button>
            <plex-button *ngIf="puedeBorrar('d')" icon="delete" tooltip="Eliminar" tooltipPosition="top"
                         class="btn btn-sm pl-0 pr-1" type="danger" size="sm" (click)="borrarDiagnostico()">
            </plex-button>
            <plex-help *ngIf="puedeReparar()" class="mr-1" icon="adi adi--herramienta" type="info" btnType="warning"
                       tooltip="Reparar" tooltipPosition="top" titulo="Codificación del Profesional">
                <plex-label><b>Codificación Snomed: &nbsp;</b>
                    {{diagnosticos[indiceDiagnostico].codificacionProfesional.snomed.term}}</plex-label>
                <plex-label> <b>Mapeo a Cie10: &nbsp;</b>
                    <ng-container *ngIf="diagnosticos[indiceDiagnostico].codificacionProfesional.cie10?.nombre">
                        {{diagnosticos[indiceDiagnostico].codificacionProfesional.cie10.nombre}}
                    </ng-container>
                </plex-label>
                <plex-label>Seleccionar código reparo Cie10</plex-label>
                <buscador-cie10 (seleccionEmit)="repararDiagnostico($event)"></buscador-cie10>
            </plex-help>

            <plex-button *ngIf="puedeBorrar('r')" class="btn btn-sm pl-0 pr-1" type="info" icon="refresh"
                         tooltip="Reestablecer" size="sm" (click)="borrarReparo()">
            </plex-button>
            <plex-button icon="arrow-left" tooltip="Volver" class="btn btn-sm pl-0" type="primary"
                         (click)="cerrarCodificar()" size="sm">
            </plex-button>
        </plex-title>
        <!-- Buscador de prestaciones cie10 -->
        <div class="row">
            <div class="col-12">
                <Label>Agregar diagnóstico</Label>
                <buscador-cie10 (seleccionEmit)="agregarDiagnostico($event)">
                </buscador-cie10>
            </div>
        </div>
        <br>
        <!-- Listado de codificaciones seleccionadas para agendas no-odontológicas -->
        <ng-container *ngIf="!esAgendaOdonto" class="row">
            <plex-table class="tabla-turnos codificacion" [columns]="columns" #table="plTable">
                <plex-table-columns>
                </plex-table-columns>
                <tr *ngFor="let diagnostico of diagnosticos; let i = index; " class="hover"
                    [class.selectable]="selectable" [class.selected]="diagnosticoSeleccionado(i)">
                    <td class="col-1 hover" (click)="seleccionarDiagnostico(i)">
                        <ng-container>
                            <i *ngIf="diagnosticoSeleccionado(i)" class="adi adi-checkbox-marked"></i>
                            <i *ngIf="!diagnosticoSeleccionado(i)" class="adi adi-checkbox-blank-outline"></i>
                        </ng-container>
                    </td>
                    <td>
                        <plex-bool *ngIf="!(diagnostico.codificacionProfesional?.snomed?.codigo || diagnostico.codificacionProfesional?.cie10?.codigo)"
                                   (change)="onSave()" [(ngModel)]='diagnostico.primeraVez'></plex-bool>
                        <!-- Muestro primera vez solo para diagnosticos de profesional -->
                        <plex-badge type="success" *ngIf="(diagnostico.codificacionProfesional?.snomed?.codigo
                                                                || diagnostico.codificacionProfesional?.cie10?.codigo) &&
                                                                diagnostico.primeraVez">
                            Si
                        </plex-badge>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <plex-badge type="success" *ngIf="diagnostico.codificacionAuditoria?.codigo
                                                                ===
                                                                diagnostico.codificacionProfesional?.cie10?.codigo">
                            Aprobado
                        </plex-badge>

                        <plex-badge type="warning" *ngIf="diagnostico.codificacionAuditoria?.codigo &&
                                                                diagnostico.codificacionProfesional?.snomed?.term &&
                                                                diagnostico.codificacionAuditoria?.codigo
                                                                !=
                                                                diagnostico.codificacionProfesional?.cie10?.codigo">
                            Reparado</plex-badge>
                        <!-- La funcion codificarTurno establece que el diagnóstico principal siempre es el primero -->
                        <plex-badge *ngIf="i==0" type="info">Principal</plex-badge>

                        <plex-badge *ngIf="diagnostico.codificacionAuditoria?.c2 || diagnostico.codificacionProfesional?.cie10?.c2"
                                    type="danger">C2</plex-badge>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <!-- Mostramos la codificación snomed hecha por profesional -->
                        <div>
                            <span
                                  *ngIf="diagnostico.codificacionProfesional?.snomed?.term">{{diagnostico.codificacionProfesional.snomed.term}}
                            </span>
                            <span *ngIf="!diagnostico.codificacionProfesional?.snomed?.term">
                                -
                            </span>
                        </div>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <div>
                            <!-- Si no mapea a cie10 -->
                            <span
                                  *ngIf="!diagnostico.codificacionProfesional?.snomed?.term &&!diagnostico.codificacionProfesional?.cie10?.codigo && !diagnostico.codificacionAuditoria?.codigo">
                                No encontrado
                            </span>
                            <!-- Mostramos el mapeo de la codificación snomed -->
                            <span
                                  *ngIf="diagnostico.codificacionProfesional?.cie10 && (!diagnostico.codificacionAuditoria?.codigo || diagnostico.codificacionAuditoria?.codigo == diagnostico.codificacionProfesional?.cie10?.codigo )">
                                ({{diagnostico.codificacionProfesional.cie10.codigo}})
                                {{diagnostico.codificacionProfesional.cie10.nombre}}
                            </span>
                            <!-- Mostramos la codificación reparada -->
                            <span
                                  *ngIf="diagnostico.codificacionAuditoria?.codigo && diagnostico.codificacionProfesional?.snomed?.term && diagnostico.codificacionAuditoria?.codigo != diagnostico.codificacionProfesional?.cie10?.codigo">
                                ({{diagnostico.codificacionAuditoria.codigo}})
                                {{diagnostico.codificacionAuditoria.nombre}}
                            </span>
                            <!-- Mostramos la codificación cuando no hay diagnóstico del profesional -->
                            <span
                                  *ngIf="!diagnostico.codificacionProfesional?.snomed?.term && diagnostico.codificacionAuditoria?.nombre">({{diagnostico.codificacionAuditoria.codigo}})
                                {{diagnostico.codificacionAuditoria.nombre}}
                            </span>
                        </div>
                    </td>
                </tr>
                <!-- </tbody> -->
            </plex-table>
        </ng-container>

        <!-- Listado de codificaciones seleccionadas para agendas odontológicas -->
        <ng-container *ngIf="esAgendaOdonto">
            <plex-table class="tabla-turnos codificacion" [columns]="columnsOdo">
                <plex-table-columns>
                </plex-table-columns>
                <tr *ngFor="let diagnostico of diagnosticos; let i = index; " class="hover"
                    [class.selectable]="selectable" [class.selected]="diagnosticoSeleccionado(i)">
                    <td class="col-1 hover" (click)="seleccionarDiagnostico(i)">
                        <ng-container>
                            <i *ngIf="diagnosticoSeleccionado(i)" class="adi adi-checkbox-marked"></i>
                            <i *ngIf="!diagnosticoSeleccionado(i)" class="adi adi-checkbox-blank-outline"></i>
                        </ng-container>
                    </td>
                    <td>
                        <plex-bool *ngIf="!diagnostico.codificacionProfesional?.cie10?.codigo" (change)="onSave()"
                                   [(ngModel)]='diagnostico.primeraVez'></plex-bool>
                        <!-- Muestro primera vez solo para diagnosticos de profesional -->
                        <plex-badge type="success"
                                    *ngIf="diagnostico.codificacionProfesional?.cie10?.codigo && diagnostico.primeraVez">
                            Si
                        </plex-badge>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <plex-badge type="success"
                                    *ngIf="diagnostico.codificacionAuditoria?.codigo === diagnostico.codificacionProfesional?.cie10?.codigo">
                            Aprobado
                        </plex-badge>
                        <plex-badge type="warning" *ngIf="diagnostico.codificacionAuditoria?.codigo && diagnostico.codificacionProfesional?.snomed?.term && diagnostico.codificacionAuditoria?.codigo
                                                            != diagnostico.codificacionProfesional?.cie10?.codigo">
                            Reparado
                        </plex-badge>
                        <!-- La funcion codificarTurno establece que el diagnóstico principal siempre es el primero -->
                        <span *ngIf="i==0" type="info">Principal</span>
                        <span *ngIf="diagnostico.codificacionAuditoria?.c2 || diagnostico.codificacionProfesional?.cie10?.c2"
                              type="danger">C2</span>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <div>
                            <!-- Mostramos el código de la prestación -->
                            <span
                                  *ngIf="diagnostico.codificacionProfesional?.cie10 && (!diagnostico.codificacionAuditoria?.codigo || diagnostico.codificacionAuditoria?.codigo == diagnostico.codificacionProfesional?.cie10?.codigo )">
                                ({{diagnostico.codificacionProfesional.cie10.codigo}})
                                {{diagnostico.codificacionProfesional.cie10.nombre}}
                            </span>
                            <!-- Mostramos la codificación reparada -->
                            <span
                                  *ngIf="diagnostico.codificacionAuditoria?.codigo && diagnostico.codificacionProfesional?.snomed?.term && diagnostico.codificacionAuditoria?.codigo != diagnostico.codificacionProfesional?.cie10?.codigo">
                                ({{diagnostico.codificacionAuditoria.codigo}})
                                {{diagnostico.codificacionAuditoria.nombre}}
                            </span>
                            <!-- Mostramos la codificación cuando no hay diagnóstico del profesional -->
                            <span
                                  *ngIf="!diagnostico.codificacionProfesional?.snomed?.term && diagnostico.codificacionAuditoria?.nombre">({{diagnostico.codificacionAuditoria.codigo}})
                                {{diagnostico.codificacionAuditoria.nombre}}
                            </span>
                        </div>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <span
                              *ngIf="!diagnostico.codificacionProfesional?.snomed && diagnostico.codificacionProfesional?.cie10?.causa">
                            {{diagnostico.codificacionProfesional.cie10.causa}}
                        </span>
                    </td>
                    <td class="hover" (click)="seleccionarDiagnostico(i)">
                        <span
                              *ngIf="!diagnostico.codificacionProfesional?.snomed && diagnostico.codificacionProfesional?.cie10?.subcausa">
                            {{diagnostico.codificacionProfesional.cie10.subcausa}}
                        </span>
                    </td>
                </tr>
            </plex-table>
        </ng-container>
    </div>
</ng-container>
<!--/ CODIFICACION -->