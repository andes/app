<form #form="ngForm">
    <plex-title size="sm" titulo="Agregar Sobreturno">
        <plex-button icon="arrow-left" tooltip="Volver" class="btn btn-sm" type="primary" tooltipPosition="left"
                     (click)="volver()" size="sm">
        </plex-button></plex-title>
    <span *ngIf="showSobreturno && paciente">
        <div *ngIf="paciente?.id" class="row">
            <div class="col">
                <label>Paciente</label>
                <div>{{paciente | nombre}}</div>
            </div>
            <div class="col" *ngIf="modelo.obraSocial !== 'SUMAR'">
                <plex-radio [data]="obraSocialPaciente" [(ngModel)]="modelo.obraSocial" name="os"
                            (change)="seleccionarObraSocial($event)" label="Seleccione una Obra Social">
                </plex-radio>
                <plex-select *ngIf="showListaPrepagas" [(ngModel)]="modelo.prepaga" name="prepagas" [data]="prepagas"
                             label="Seleccione una Prepaga" idField="nombre" labelField="nombre">
                </plex-select>
            </div>
            <div class="col" *ngIf="modelo.obraSocial === 'SUMAR'">
                <label>Programa</label>
                <div>{{modelo.obraSocial}}</div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <plex-phone *ngIf="paciente" label="Verifique el número telefónico:" [(ngModel)]="telefono"
                            (change)="cambioTelefono=true" name="telefono"></plex-phone>
                <plex-text *ngIf="carpetaEfector" (change)="cambiarCarpeta()" label="Nro Carpeta" name="nroCarpeta"
                           [(ngModel)]="carpetaEfector.nroCarpeta"></plex-text>
            </div>
            <div class="col">
                <plex-text label="Observaciones" name="nota" multiline="true" [(ngModel)]="nota"
                           (change)="verificarNota()"></plex-text>
            </div>
        </div>
        <div class="row" *ngIf="agenda && agenda.tipoPrestaciones.length > 1">
            <div class="col">
                <plex-select [(ngModel)]="tipoPrestacion" name="tipoPrestacion" label="Tipo de prestación"
                             [data]="agenda.tipoPrestaciones" placeholder="Seleccione el tipo de prestación"
                             [required]="true">
                </plex-select>
            </div>
        </div>
        <div class="row">
            <div class="col-3">
                <plex-datetime type="time" [(ngModel)]="horaTurno" [min]="inicio" [max]="fin" [required]="true"
                               name="horaTurno" label="Hora Turno">
                </plex-datetime>
            </div>
            <div *ngIf="agenda.link" class="col">
                <plex-text placeholder="Ingrese link turno virtual" [(ngModel)]="turno_link" [required]="true"
                           name="turno_link" label="Link">
                </plex-text>
            </div>
        </div>
    </span>
</form>

<ng-container *ngIf="!showSobreturno && pacientesSearch">
    <paciente-buscar (searchStart)="onSearchStart()" (searchEnd)="onSearchEnd($event.pacientes,$event.scan)"
                     (searchClear)="onSearchClear()">
    </paciente-buscar>

    <plex-loader *ngIf="loading"></plex-loader>

    <paciente-listado *ngIf="pacientes && pacientes.length" [offset]="110" [pacientes]="pacientes"
                      (selected)="onSelect($event)"></paciente-listado>

    <div *ngIf="pacientes && !pacientes.length" class="alert">
        <i class="adi adi-account-alert"></i> No se encontró ningún paciente.
    </div>
</ng-container>

<plex-title *ngIf="paciente"></plex-title>

<div *ngIf="paciente" class="row">

    <div class="col">
        <plex-button left type="danger" (click)="volver()">
            Cancelar
        </plex-button>
    </div>
    <div class="col text-right">
        <plex-button class="mr-1" [validateForm]="form" type="success" position="right" (click)="guardar($event)">
            Guardar
        </plex-button>
    </div>
</div>