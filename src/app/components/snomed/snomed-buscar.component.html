<form *ngIf="!hideSearchInput">
    <div class="buscador">
        <plex-text [(ngModel)]="searchTerm" name="searchTerm" (keyup)="buscar()" placeholder="Buscar {{tipoBusqueda === 'problemas' ? 'hallazgos' : tipoBusqueda}} ..."></plex-text>
    </div>
</form>


<!--MAESTRO DE PROBLEMAS - BD:tipoProblema-->
<div class="menu-buscador">
    <plex-loader class="float-right" *ngIf="loading" type="ball-pulse"></plex-loader>
    <div class="filtros d-flex">
        <b>Filtros</b>
        <small class="ml-3" *ngIf="searchTerm && resultados && resultados.length === 0 && !loading">
            No se han encontrado resultados
        </small>
    </div>
    <div class="row m-0 mb-3 pb-3 d-flex botones-filtros">
        <div class="col m-0 p-0">
            <button (click)="filtroBuscadorSnomed(['hallazgo', 'situacion'])" [ngClass]="{}">
                HALLAZGOS
                <small *ngIf="(contadorSemanticTags['hallazgo'] + contadorSemanticTags['situacion']) > 0" class="badge badge-hallazgos ml-1 float-right">
                    {{ contadorSemanticTags['hallazgo'] + contadorSemanticTags['situacion']}}</small>
            </button>
        </div>
        <div class="col m-0 p-0">
            <button (click)="filtroBuscadorSnomed(['trastorno'])" [ngClass]="{}">
                TRASTORNOS
                <small *ngIf="contadorSemanticTags['trastorno'] > 0" class="badge badge-trastornos ml-1 float-right"> {{ contadorSemanticTags['trastorno'] }}</small>
            </button>
        </div>
        <div class="col m-0 p-0">
            <button (click)="filtroBuscadorSnomed(['procedimiento', 'entidad observable'])" class="procedimientos">
                PROCEDIMIENTOS
                <small *ngIf="(contadorSemanticTags['procedimiento'] + contadorSemanticTags['entidadObservable']) > 0" class="badge badge-procedimientos ml-1 float-right">
                    {{ contadorSemanticTags['procedimiento'] + contadorSemanticTags['entidadObservable']}}</small>
            </button>
        </div>
        <div class="col m-0 p-0">
            <button (click)="filtroBuscadorSnomed(['procedimiento'], 'planes')" class="planes">
                PLANES
                <small *ngIf="contadorSemanticTags['procedimiento'] > 0" class="badge badge-planes ml-1 float-right"> {{ contadorSemanticTags['procedimiento'] }}</small>
            </button>
        </div>
    </div>
</div>

<plex-button label="BÚSQUEDA GUIADA" (click)="filtroRefSet()" type="primary"></plex-button>

<ul *ngIf="!showRefSets" class="conceptos list-unstyled">
    <ng-container *ngFor="let item of resultados">
        <li draggable class="" *ngIf="!hideLista" [dragHandle]="'.drag-bar'" [dragScope]="_dragScope" [dragOverClass]="_dragOverClass"
            [dragData]="item" (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
            <div class="rup-card mini {{ tipoBusqueda !== 'planes' ? item.semanticTag : 'planes'}}">
                <div *ngIf="_dragScope" class=" type">
                    <i #dragHandle class="drag-bar drag-handle mdi mdi-drag-vertical"></i>
                </div>

                <div class="rup-content">
                    <div class="header row m-0 pl-0" [ngClass]="{'actions-left': tipoBusqueda === 'equipamientos'}">
                        <div class="title col-6">
                            {{ item.term }}
                        </div>
                        <div class="col pr-1" [ngClass]="{'float-right text-right': _dragScope, 'd-flex': tipoBusqueda === 'equipamientos'}">
                            <small class="badge badge-{{ (tipoBusqueda === 'planes' ? 'planes' : item.semanticTag + 's') }} text-default">{{ item.semanticTag }}</small>
                            <a href="javascript: void(0)" (click)="seleccionarConcepto(item)">
                                <i class="mdi mdi-plus-box"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </li>
    </ng-container>
</ul>

<!-- refsetids -->
<div *ngIf="showRefSets && arrayPorRefsets">

    <ul class="conceptos list-unstyled">
        <!-- <plex-accordion> -->
        <ng-container *ngFor="let items of arrayPorRefsets, let i = index;">
            <li>
                <div class="rup-card mini">
                    <div class="container rup-content">
                        <div class="row header">
                            <div class="col-10">
                                <b>{{items.nombre}}</b>
                                <br> pequeña descripcion
                            </div>
                            <div class="col-1">
                                <span class="badge-warning">
                                    {{ items.valor.length }}
                                </span>
                            </div>
                            <div class="col-1">
                                <a href="javascript: void(0)" class="btn btn-sm btn-primary" (click)='desplegar(i , items.nombre)'>
                                    <i class="mdi mdi-chevron-down"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>





                <div *ngIf="showContent === items.nombre">
                    <ng-container *ngIf="items.valor.length === 0">
                        <p>No hay resultados</p>
                    </ng-container>
                    <ul class="conceptos list-unstyled">
                        <ng-container *ngFor="let item of items.valor">
                            <li draggable class="" *ngIf="!hideLista" [dragHandle]="'.drag-bar'" [dragScope]="_dragScope" [dragOverClass]="_dragOverClass"
                                [dragData]="item" (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                                <div class="rup-card mini {{ tipoBusqueda !== 'planes' ? item.semanticTag : 'planes'}}">
                                    <div *ngIf="_dragScope" class=" type">
                                        <i #dragHandle class="drag-bar drag-handle mdi mdi-drag-vertical"></i>
                                    </div>
                                    <div class="rup-content">
                                        <div class="header" [ngClass]="{'actions-left': tipoBusqueda === 'equipamientos'}">
                                            <div class="title">
                                                {{ item.term }}
                                            </div>
                                            <div [ngClass]="{'actions': _dragScope, 'actions-left': tipoBusqueda === 'equipamientos'}">
                                                <a href="javascript: void(0)" (click)="seleccionarConcepto(item)">
                                                    <i class="mdi mdi-plus-box-outline"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </li>
                        </ng-container>
                    </ul>
                </div>
            </li>
        </ng-container>
        <!-- </plex-accordion> -->

    </ul>
</div>