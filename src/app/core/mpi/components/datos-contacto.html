<section class="mt-2">
    <form #form="ngForm">
        <plex-grid type="full" cols="2" responsive>
            <div class="columna">
                <plex-title titulo=" datos de contacto" size="sm">
                    <plex-bool [(ngModel)]="noPoseeContacto" label="Sin datos de contacto" name="noPoseeContacto"
                               type="slide" (change)="limpiarContacto()"></plex-bool>
                </plex-title>

                <plex-wrapper *ngFor="let _unContacto of paciente.contacto; let i = index">

                    <plex-select [(ngModel)]="_unContacto.tipo" [data]="tipoComunicacion" name="tipo-{{i}}"
                                 [required]="i <= 0" label="Tipo" (change)="_unContacto.valor = ''"
                                 [readonly]="noPoseeContacto">
                    </plex-select>

                    <ng-container *ngIf="_unContacto.tipo">
                        <plex-phone *ngIf="_unContacto.tipo === 'fijo' || _unContacto.tipo.id === 'fijo'" label="Número"
                                    [(ngModel)]="_unContacto.valor" placeholder="Ej: 2990000000" name="valor-{{i}}"
                                    [required]="!noPoseeContacto && (i <= 0)" [readonly]="noPoseeContacto">
                        </plex-phone>
                        <plex-phone label="Número"
                                    *ngIf="_unContacto.tipo === 'celular' || _unContacto.tipo.id === 'celular'"
                                    [(ngModel)]="_unContacto.valor" placeholder="Ej: 2990000000"
                                    [required]="!noPoseeContacto && (i <= 0)" name="valor-{{i}}"
                                    [readonly]="noPoseeContacto">
                        </plex-phone>
                        <plex-text label="Dirección"
                                   *ngIf="_unContacto.tipo === 'email' || _unContacto.tipo.id === 'email'"
                                   [(ngModel)]="_unContacto.valor" placeholder="Ej: ejemplo@email.com"
                                   [required]="!noPoseeContacto && (i <= 0)" name="valor-{{i}}"
                                   (change)="verificarCorreoValido(i, $event.value)" [readonly]="noPoseeContacto">
                        </plex-text>

                        <plex-button *ngIf="i == 0" title="Agregar contacto" titlePosition="left" type="info"
                                     icon="plus" name="agregarContacto" (click)="addContacto('celular', '')"
                                     [disabled]="noPoseeContacto">
                        </plex-button>
                    </ng-container>

                    <plex-button *ngIf="i > 0" label="" type="danger" icon="close" (click)="removeContacto(i)">
                    </plex-button>

                </plex-wrapper>

                <!-- DATOS DE DOMICILIO -->

                <plex-title titulo="Datos del domicilio" size="sm"></plex-title>
                <ng-container *ngIf="paciente?.direccion?.length">

                    <plex-bool class="mr-3" *ngIf="provinciaActual" [(ngModel)]="viveProvActual"
                               label="¿Vive en la Provincia de {{provinciaActual.nombre}}?" name="viveProvActual"
                               (change)="changeProvActual()">
                    </plex-bool>

                    <plex-bool *ngIf="viveProvActual && localidadActual" [(ngModel)]="viveLocActual"
                               label="¿Vive en la Localidad {{localidadActual.nombre}}?" name="viveLocActual"
                               (change)="changeLocalidadActual()">
                    </plex-bool>


                    <plex-wrapper>
                        <plex-select [disabled]="viveProvActual" [(ngModel)]="paciente.direccion[0].ubicacion.provincia"
                                     name="provincia" [required]="!viveProvActual" [data]="provincias$ | async"
                                     idField="nombre" labelField="nombre" label="Provincia"
                                     (change)="loadLocalidades(paciente.direccion[0].ubicacion.provincia)">
                        </plex-select>

                        <plex-select [disabled]="viveLocActual" label="Localidad" [required]="viveProvActual"
                                     [(ngModel)]="paciente.direccion[0].ubicacion.localidad" name="localidad"
                                     [data]="localidades$ | async" labelField="nombre"
                                     (change)="loadBarrios(paciente.direccion[0].ubicacion.localidad)" grow="2">
                        </plex-select>

                        <!-- barrios solo para NQN capital-->
                        <plex-select label="Barrio" [disabled]="!viveLocActual"
                                     [(ngModel)]="paciente.direccion[0].ubicacion.barrio" name="barrio"
                                     [data]="barrios$ | async" labelField="nombre" grow="1">
                        </plex-select>
                    </plex-wrapper>

                    <plex-wrapper>
                        <plex-text label="Dirección" [(ngModel)]="paciente.direccion[0].valor" name="direccion"
                                   placeholder="Ej: Avenida las Flores 1200">
                        </plex-text>

                        <plex-button [disabled]="disableGeoreferenciar" type="info" size="md" icon="map-marker"
                                     (click)="geoReferenciar()">
                        </plex-button>
                    </plex-wrapper>
                </ng-container>
            </div>

            <!-- MAPA -->
            <georref-map class="columna" #mapa [latLong]="georeferencia$ | async"
                         (changeCoordinates)="changeCoordenadas($event)">
            </georref-map>
        </plex-grid>
    </form>
</section>