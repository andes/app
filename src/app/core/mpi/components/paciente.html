<plex-layout main="{{ mainSize }}">
    <plex-layout-main>
        <header>
            <plex-title size="lg" titulo="Alta de pacientes">
                <plex-button class="pr-1" label="Volver" type="danger" position="left" (click)="cancel()"></plex-button>
                <plex-button *ngIf="pacienteModel.id && pacienteModel.estado === 'validado' && !showMobile"
                             label="Gestión de App Mobile" type="info" position="right" (click)="gestionMobile(true)"
                             class="pr-1">
                </plex-button>
                <plex-button *ngIf="showMobile" class="pr-1" label="Volver a detalles paciente" type="info"
                             position="right" (click)="gestionMobile(false)">
                </plex-button>
                <plex-button *ngIf="(tipoPaciente === '' || tipoPaciente === 'con-dni') && !showDeshacer" class="pr-1"
                             label="Validar Paciente" type="info" position="right" [disabled]="disableValidar"
                             (click)="validarPaciente($event)">
                </plex-button>
                <plex-button *ngIf="showDeshacer" class="pr-1" label="Deshacer Validación" type="warning"
                             position="right" (click)="deshacerValidacion()"></plex-button>
                <plex-button *ngIf="visualizarIgnorarGuardar" class="pr-1" [disabled]="disableIgnorarGuardar"
                             label="Ignorar y Guardar" type="warning" position="right" [validateForm]="formulario"
                             (click)="save($event,true)">
                </plex-button>
                <plex-button [disabled]="disableGuardar" class="pr-1" label="Guardar" type="success" position="right"
                             [validateForm]="formulario" (click)="save($event,false)"></plex-button>
            </plex-title>
        </header>
        <!-- loader -->
        <plex-loader *ngIf="loading" class="loading" type="ball-pulse"></plex-loader>
        <form #formulario="ngForm" [ngClass]="{'loadMode': loading}">

            <plex-tabs [activeIndex]="tabIndex" (change)="checkTabs($event)">

                <plex-tab label="datos básicos" icon="" (click)="tabIndex = 0">
                    <datos-basicos [paciente]="pacienteModel" [tipoPaciente]="tipoPaciente"
                                   (changes)="datosBasicosForm($event)" name="datos basicos">
                    </datos-basicos>
                </plex-tab>

                <plex-tab label="datos de contacto" icon="" (click)="tabIndex = 1">
                    <datos-contacto [paciente]="pacienteModel" (changes)="datosContactoForm($event)">
                    </datos-contacto>
                </plex-tab>

                <plex-tab *ngIf="tipoPaciente !== 'bebe'" label="Relaciones" icon="account-multiple"
                          (click)="tabIndex = 2">
                    <!-- FAMILIARES: No se muestra para el caso del bebé -->
                    <relaciones-pacientes #relaciones [paciente]="pacienteModel"
                                          (actualizar)="actualizarRelaciones($event)">
                    </relaciones-pacientes>
                </plex-tab>

                <plex-tab label="Notas" icon="file-multiple" (click)="tabIndex = 3">
                    <notas-paciente [notas]="pacienteModel.notas" (notasNew)="notasNotification($event)">
                    </notas-paciente>
                </plex-tab>


            </plex-tabs>
        </form>
    </plex-layout-main>

    <plex-layout-sidebar type="invert">
        <div [ngClass]="{'loadMode': loading}">
            <span *ngIf='!showMobile'>
                <!-- Pacientes candidatos -->
                <div *ngIf='(pacientesSimilares && pacientesSimilares.length > 0); else showPanel' type="invert"
                     title="Pacientes Candidatos">
                    <header>
                        <h4>Pacientes Candidatos</h4>
                    </header>
                    <div class="row">
                        <div class="col-md-12 hover">
                            <ul class="list-group">
                                <li class="list-group-item justify-content-between"
                                    *ngFor="let elem of pacientesSimilares">
                                    <h4 class="box-title-elemento">{{elem.paciente.apellido| uppercase}}
                                        {{elem.paciente.nombre| uppercase}}
                                        <br>
                                        <small>Documento: {{elem.paciente.documento}}
                                            <br> fecha de Nacimiento: {{elem.paciente.fechaNacimiento | fecha }}
                                            <br> Sexo: {{elem.paciente.sexo}}
                                        </small>

                                    </h4>
                                    <h4>Similitud: {{elem.match * 100}} %
                                        <span>
                                            <plex-button type="primary btn-sm" icon="account" label="Seleccionar"
                                                         (click)="onSelect(elem.paciente)"></plex-button>
                                        </span>
                                    </h4>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <ng-template #showPanel>
                    <paciente-panel [paciente]="pacienteModel" [direction]="detailDirection"
                                    [showRelaciones]="showRelaciones" (changeRelacion)="toRelacionesOnChange($event)">
                    </paciente-panel>
                </ng-template>
            </span>
        </div>
        <activar-app *ngIf='showMobile' [paciente]="pacienteModel"></activar-app>
    </plex-layout-sidebar>

    <!-- <plex-layout-footer>
        <plex-button *ngIf="pacienteModel.id && pacienteModel.estado === 'validado' && !showMobile"
                     label="Gestión de App Mobile" type="info" position="right" (click)="gestionMobile(true)"
                     class="pr-1">
        </plex-button>
        <plex-button *ngIf="showMobile" label="Volver a detalles paciente" class="pr-1" type="info" position="right"
                     (click)="gestionMobile(false)">
        </plex-button>
        <plex-button *ngIf="opcion === '' || opcion === 'con-dni'" class="pr-1" label="Validar Paciente" type="info"
                     position="right" [disabled]="disableValidar" (click)="validarPaciente($event)">
        </plex-button>
        <plex-button *ngIf="showDeshacer" class="pr-1" label="Deshacer Validación" type="warning" position="right"
                     (click)="deshacerValidacion()"></plex-button>
        <plex-button *ngIf="visualizarIgnorarGuardar" [disabled]="disableIgnorarGuardar" label="Ignorar y Guardar"
                     type="warning" position="right" [validateForm]="formulario" (click)="save($event,true)">
        </plex-button>
        <plex-button label="Cancelar" type="danger" position="left" (click)="cancel()"></plex-button>
        <plex-button [disabled]="disableGuardar" class="pr-1" label="Guardar" type="success" position="right"
                     [validateForm]="formulario" (click)="save($event,false)"></plex-button>

    </plex-layout-footer> -->

</plex-layout>