<plex-tabs [activeIndex]="pestaniaActiva" (change)="cambio($event)">
    <plex-tab label="Selección Usuario" color="procedimiento">
        <div class="mt-3">
            <div class='row'>
                <div class='col-11'>
                    <plex-text [(ngModel)]="textoLibre" (change)="loadUsuarios()" prefix="<i class='mdi mdi-account-search'></i>"
                        placeholder="Buscar por DNI, nombre o apellido">
                    </plex-text>
                </div>
                <div class='col-1 d-flex justify-content-end'>
                    <plex-button *ngIf='!mostrarFiltrosAvanzados' icon="mdi mdi-menu-down" type="primary" (click)='mostrarFiltrosAvanzados = true'></plex-button>
                    <plex-button *ngIf='mostrarFiltrosAvanzados' icon="mdi mdi-menu-up" type="primary" (click)='mostrarFiltrosAvanzados = false'></plex-button>
                </div>
            </div>
            <ng-container *ngIf='mostrarFiltrosAvanzados'>
                <plex-select [(ngModel)]="organizacionBusqueda" name="organizacionDestino" (change)="loadUsuarios()"
                    label="Organización" placeholder="Seleccione la organización" labelField="nombre" (getData)="loadOrganizacion($event)">
                </plex-select>
            </ng-container>

            <div *ngIf="users && !users.length" class="alert alert-danger">
                <i class="mdi mdi-account-alert"></i> El usuario no se ha encontrado
            </div>
            <!--Tabla de resultados por SimpleQuery -->
            <table *ngIf="users && users.length" class="table table-striped">
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Apellido</th>
                        <th>Nombre</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="hover" *ngFor="let user of users  | textFilter:textoLibre ; let i=index" (click)="seleccionarUsuario(user)">
                        <td>{{user.usuario}}</td>
                        <td *ngIf="user.apellido; else sinDatos">
                            {{user.apellido}}
                        </td>
                        <td *ngIf="user.nombre; else sinDatos">
                            {{user.nombre}}
                        </td>
                        <ng-template #sinDatos>
                            <td> SIN DATOS</td>
                        </ng-template>
                    </tr>
                </tbody>
            </table>
        </div>
    </plex-tab>
    <plex-tab *ngIf="usuarioSeleccionado" label="Selección Organización">
        <!-- <legend>Datos del usuario</legend> -->

        <div class="row my-3">
            <div class="col">
                <div class="page-title float-left">Datos del Usuario</div>
            </div>
            <div class="col d-flex justify-content-end">
                <ng-container *ngIf="showAgregarEfector">
                    <plex-button type="success" icon='mdi mdi-plus' (click)="newEfector()" title='Agregar Efector'></plex-button>
                </ng-container>
                <ng-container *ngIf="showAgregarEfector">
                    <plex-button *ngIf='organizacionActualAuthUs && !organizacionActualAuthUs.permisosPausados' type="danger"
                        icon='mdi mdi-stop' (click)='pausar()' title='Pausar'></plex-button>
                    <plex-button *ngIf=' organizacionActualAuthUs && organizacionActualAuthUs.permisosPausados' type="success"
                        icon='mdi mdi-play' (click)='pausar()' title='Reanudar'></plex-button>
                </ng-container>
                <ng-container *ngIf="showAgregarEfector && organizacionActualAuthUs">
                    <plex-button type="info" icon='mdi mdi-content-copy' (click)="sideBarPermisos = true" title='Copiar Permisos'></plex-button>
                </ng-container>
                <ng-container *ngIf="showAgregarEfector">
                    <plex-button type="danger" icon='mdi mdi-delete' (click)="deleteEfector()" *ngIf="organizacionesUsuario?.length"
                        title='Quitar Efector'></plex-button>
                </ng-container>
            </div>
        </div>

        <div class="row my-3">
            <div class="col">
                <label class="block">Nombre</label>
                <span>{{usuarioSeleccionado.nombre}}</span>
            </div>
            <div class="col">
                <label class="block">Apellido</label>
                <span>{{usuarioSeleccionado.apellido}}</span>
            </div>
            <div class="col d-flex align-items-end" *ngIf="profesionalAsociadoUsuario">
                <label class="block"></label>
                <span class="badge-success"> Profesional </span>
            </div>
        </div>

        <!-- A partir de aca  -->
        <div *ngIf="!hidePermisos" class="row">
            <div class="col">
                <plex-select [(ngModel)]="organizacionSelect" name="organizacion" [data]="organizacionesUsuario"
                    [required]="true" (change)="onOrgChange()" labelField="nombre + ', ' + direccion.ubicacion.localidad.nombre">
                </plex-select>
            </div>
        </div>
        <div class="row">&nbsp;</div>
        <!-- <div *ngIf="organizacionesUsuario.length > 0 && organizacionSelect">
                <div *ngFor="let permiso of permisos$ | async ">
                    <arbolPermisos [item]="permiso" [userPermissions]="permisos"></arbolPermisos>
                </div>
            </div> -->
        <div *ngIf="organizacionesUsuario.length <= 0" class="alert alert-default">
            <i class="mdi mdi-emoticon-sad"></i> Agregue un efector para modificar sus permisos
        </div>
        <div *ngIf="organizacionesUsuario.length > 0 && !organizacionSelect" class="alert alert-default">
            <i class="mdi mdi-emoticon-sad"></i> Seleccione una organización
        </div>
        <!-- <div class="row" *ngIf="hidePermisos">
            <div class="col-9">
                <plex-select [(ngModel)]="newOrg" name="nuevaOrganizacion" [data]="newOrganizaciones" [required]="true"
                    labelField="nombre + ', ' + direccion.ubicacion.localidad.nombre" placeholder="Seleccione efector"></plex-select>
            </div>
            <div class="col-3 d-flex justify-content-end align-items-start">
                <plex-button type="primary" size="sm" label="Agregar" (click)="agregarOrg()"></plex-button>
                <plex-button type="danger" size="sm" label="Cancelar" (click)="cancelarOrg()"></plex-button>
            </div>
        </div> -->

        <div class="row my-3" *ngIf="hidePermisos">
            <div class="col mb-3">
                <div class="page-title d-flex justify-content-start">Nuevo Efector</div>
            </div>
            <div class="col mb-3 d-flex justify-content-end">
                <plex-button type="danger" label="Cancelar" (click)="cancelarOrg()"></plex-button>
                <plex-button type="primary" label="Agregar" (click)="agregarOrg()"></plex-button>
            </div>
            <div class="col-12">
                <plex-select [(ngModel)]="newOrg" name="nuevaOrganizacion" [data]="newOrganizaciones" [required]="true"
                    labelField="nombre + ', ' + direccion.ubicacion.localidad.nombre" placeholder="Seleccione efector"></plex-select>
            </div>
        </div>
        <!-- hasta aca -->
    </plex-tab>
</plex-tabs>
