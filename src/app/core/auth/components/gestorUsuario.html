<plex-layout [main]="6">
    <plex-layout-main>
        <selectorUsuarioEfector (seleccionOrganizacion)="seleccionOrganizacion($event)"
            (seleccionUsuario)="seleccionUsuario($event)" (pestaniaUsuarioActiva)="cambioPestaniaMain($event)">
        </selectorUsuarioEfector>
    </plex-layout-main>
    <plex-layout-sidebar>
        <plex-tabs [activeIndex]="pestaniaActiva" (change)="cambio($event)">

            <plex-tab label="Visualizar permisos" color="procedimiento">
                <div *ngIf="!pestaniaUsuarioActiva && usuarioSeleccionado && organizacionSeleccionada && prestacionesTurneables && permisosUsuarioOrg"
                    class="row mt-4 mb-1">
                    <div class="col-8">
                        <div class="page-title float-left">Agrupación de Permisos</div>
                    </div>
                    <div class="col-4 d-flex justify-content-end"
                        *ngIf="!pestaniaUsuarioActiva && usuarioSeleccionado && organizacionSeleccionada && puedeVerPerfiles">
                        <plex-button type="info" label="Ver Agrupaciones" (click)="navegarAPerfiles()"></plex-button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 hover"
                        *ngIf="!pestaniaUsuarioActiva && usuarioSeleccionado && organizacionSeleccionada && prestacionesTurneables && permisosUsuarioOrg">
                        <permisosVisualizacion [user]="usuarioSeleccionado" [org]="organizacionSeleccionada"
                            [permiteAsignarPerfiles]="false" [arbolPermisosCompleto]="arbolPermisosCompleto"
                            [permisosUsuario]='permisosUsuarioOrg' [prestacionesTurneables]="prestacionesTurneables">
                        </permisosVisualizacion>
                    </div>
                </div>
                <div class="row" *ngIf="pestaniaUsuarioActiva || !usuarioSeleccionado || !organizacionSeleccionada">
                    <div class="col mt-5">
                        <i class="mdi mdi-emoticon-sad"></i>Seleccione un usuario y organización para visualizar sus
                        permisos
                    </div>
                </div>
            </plex-tab>

            <plex-tab label="Editar permisos">
                <div *ngIf="!pestaniaUsuarioActiva && usuarioSeleccionado && organizacionSeleccionada"
                    class="row mt-4 mb-1">
                    <div class="col-8">
                        <div class="page-title">PERMISOS</div>
                    </div>
                    <div class="col-4 d-flex justify-content-end">
                        <plex-button type="danger" label="Cancelar" (click)="cancelar()"></plex-button>
                        <plex-button type="success" label="Guardar" (click)="guardar($event)"></plex-button>
                    </div>
                    <div class="col" *ngIf="permisosUsuarioOrg && prestacionesTurneables">
                        <div *ngFor="let permiso of permisos$ | async">
                            <arbolPermisos [item]="permiso" [userPermissions]='permisosUsuarioOrg'
                                (seleccionPermiso)="seleccionPermiso($event)"
                                [prestacionesTurneables]="prestacionesTurneables"></arbolPermisos>
                        </div>
                    </div>
                </div>
                <div *ngIf="!pestaniaUsuarioActiva && usuarioSeleccionado && organizacionSeleccionada" class="row">
                    <div class="col-12 mt-5">
                        <div class="page-title">AGRUPACIÓN DE PERMISOS</div>
                    </div>
                    <div class="col" *ngIf="permisosUsuarioOrg && prestacionesTurneables">
                        <permisosVisualizacion [user]="usuarioSeleccionado" [org]="organizacionSeleccionada"
                            [permiteAsignarPerfiles]="true" (seleccionCheckboxPerfil)="seleccionPerfil($event)"
                            [arbolPermisosCompleto]="arbolPermisosCompleto" [permisosUsuario]='permisosUsuarioOrg'
                            [prestacionesTurneables]="prestacionesTurneables"></permisosVisualizacion>
                    </div>
                </div>
                <div *ngIf="pestaniaUsuarioActiva || !usuarioSeleccionado || !organizacionSeleccionada" class="row">
                    <div class="col mt-5">
                        <i class="mdi mdi-emoticon-sad"></i>Seleccione un usuario y organización para editar sus
                        permisos
                    </div>
                </div>

            </plex-tab>
        </plex-tabs>
    </plex-layout-sidebar>
</plex-layout>
