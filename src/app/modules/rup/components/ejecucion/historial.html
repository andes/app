<div class="historial-container">
    <!-- Loader -->
    <div *ngIf="isLoading" class="d-flex justify-content-center">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Cargando historial...</span>
        </div>
    </div>

    <!-- Historial encontrado -->
    <ng-container *ngIf="!isLoading && filteredHistorial.length > 0">
        <p class="historial-title">Historial de Evoluciones</p>
        <div class="historial-list">
            <div *ngFor="let record of (showFullHistory ? filteredHistorial : (historial$ | async))" class="historial-item">
                <div class="historial-date">
                    <span>{{ record.createdAt | date:'dd/MM/yyyy' }}</span>
                </div>
                <div class="historial-value" [innerHTML]="record.valor"></div>
            </div>
        </div>

        <!-- BotÃ³n mostrar/ocultar -->
        <div class="text-center mt-3" *ngIf="filteredHistorial.length > (params.cantidad || 0)">
            <plex-button [label]="showFullHistory ? 'Ocultar historial' : 'Mostrar historial completo'"
                         (click)="toggleFullHistory()"
                         type="info"
                         size="sm">
            </plex-button>
        </div>
    </ng-container>

    <!-- Sin resultados -->
    <ng-container *ngIf="!isLoading && filteredHistorial.length === 0">
        <p class="text-muted text-center">No se encontraron evoluciones previas.</p>
    </ng-container>
</div>
