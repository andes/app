<!-- Apunta a components/snomed/snomed-buscar.component.ts -->
<snomed-buscar (loading)="Loader($event)" (_resultados)="recibeResultados($event)"></snomed-buscar>



<!-- MAESTRO DE PROBLEMAS - BD:tipoProblema -->
<div class="menu-buscador" *ngIf="!showRefSets">
    <plex-loader class="float-right" *ngIf="loading" type="ball-pulse"></plex-loader>
    <div class="filtros d-flex">
        <b>Filtros</b>
        <small class="ml-3" *ngIf="searchTerm && resultados && resultados.length === 0 && !loading">
            No se han encontrado resultados
        </small>
    </div>
    <div class="row m-0 mb-3 pb-3 d-flex botones-filtros">
        <div class="col m-0 p-0">
            <small *ngIf="(contadorSemanticTags['hallazgo'] + contadorSemanticTags['situacion']) > 0" class="badge badge-hallazgos ml-1 float-right">
                {{ contadorSemanticTags['hallazgo'] + contadorSemanticTags['situacion']}}</small>

            <button *ngIf="!showFrecuentes" (click)="filtroBuscadorSnomed(['hallazgo', 'situacion'])" [ngClass]="{'border-hallazgos': getFiltroActual(['hallazgo', 'situacion'])}">
                HALLAZGOS
            </button>


            <button *ngIf="arrayFrecuentes && showFrecuentes" (click)="filtroFrecuentes(['hallazgo', 'situacion'])" [ngClass]="{'border-hallazgos': getFiltroActual(['hallazgo', 'situacion'])}">
                HALLAZGOS
            </button>


        </div>
        <div class="col m-0 p-0">
            <small *ngIf="contadorSemanticTags['trastorno'] > 0" class="badge badge-trastornos ml-1 float-right"> {{ contadorSemanticTags['trastorno'] }}</small>

            <button *ngIf="!showFrecuentes" (click)="filtroBuscadorSnomed(['trastorno'])" [ngClass]="{'border-trastornos': getFiltroActual(['trastorno'])}">
                TRASTORNOS
            </button>

            <button *ngIf="arrayFrecuentes && showFrecuentes" (click)="filtroFrecuentes(['trastorno'])" [ngClass]="{'border-trastornos': getFiltroActual(['trastorno'])}">
                TRASTORNOS
            </button>

        </div>
        <div class="col m-0 p-0">
            <small *ngIf="(contadorSemanticTags['procedimiento'] + contadorSemanticTags['entidadObservable']) > 0" class="badge badge-procedimientos ml-1 float-right">
                {{ contadorSemanticTags['procedimiento'] + contadorSemanticTags['entidadObservable']}}</small>

            <button *ngIf="!showFrecuentes" (click)="filtroBuscadorSnomed(['procedimiento', 'entidad observable', 'régimen/tratamiento'])" class="procedimientos" [ngClass]="{'border-procedimientos': getFiltroActual(['procedimiento', 'entidad observable'])}">
                PROCEDIMIENTOS
            </button>

            <button *ngIf="arrayFrecuentes && showFrecuentes" (click)="filtroFrecuentes(['procedimiento', 'entidad observable'])" class="procedimientos" [ngClass]="{'border-procedimientos': getFiltroActual(['procedimiento', 'entidad observable'])}">
                PROCEDIMIENTOS
            </button>

        </div>
        <div class="col m-0 p-0">
            <small *ngIf="contadorSemanticTags['procedimiento'] > 0" class="badge badge-planes ml-1 float-right"> {{ contadorSemanticTags['procedimiento'] + contadorSemanticTags['regimenTratamiento'] }}</small>

            <button *ngIf="!showFrecuentes" (click)="filtroBuscadorSnomed(['procedimiento'], 'planes')" class="planes" [ngClass]="{'border-planes': getFiltroActual(['planes'])}">
                PLANES
            </button>

            <button *ngIf="arrayFrecuentes && showFrecuentes" (click)="filtroFrecuentes(['procedimiento'], 'planes')" class="planes" [ngClass]="{'border-planes': getFiltroActual(['planes'])}">
                PLANES
            </button>

        </div>
        <div class="col m-0 p-0">
            <small *ngIf="contadorSemanticTags['producto'] > 0" class="badge badge-productos ml-1 float-right">
                {{ contadorSemanticTags['producto'] }}</small>
            <button *ngIf="!showFrecuentes" (click)="filtroBuscadorSnomed(['producto'])" class="productos" [ngClass]="{'border-productos': getFiltroActual(['producto'])}">
                PRODUCTOS
            </button>

            <button *ngIf="arrayFrecuentes && showFrecuentes" (click)="filtroFrecuentes(['producto'])" class="productos" [ngClass]="{'border-productos': getFiltroActual(['producto'])}">
                PRODUCTOS
            </button>
        </div>
    </div>
</div>

<div class="row" *ngIf="resultados && resultados.length > 0 && !loading">
    <div class="col-4">
        <!-- <span *ngIf="showRefSets"> -->
            <b *ngIf="showFrecuentes">Frecuentes</b>
            <b *ngIf="showRefSets && !showGuiada">Búsqueda guiada</b>
        <!-- </span> -->
    </div>
    <div class="col-8">
        <button class="btn btn-primary btn-sm float-right m-1" (click)="showRefSets = true; showFrecuentes = false; showGuiada = false" *ngIf="!showRefSets || showGuiada">BÚSQUEDA GUIADA</button>
        <button class="btn btn-primary btn-sm float-right m-1" (click)="showRefSets = false; showFrecuentes = false; contarSemanticTags(resultadosAux)" *ngIf="(showRefSets && !showGuiada) || showFrecuentes">BUSCADOR BASICO</button>
        <button class="btn btn-primary btn-sm float-right m-1" (click)="showFrecuentes = true; showRefSets = false; contarSemanticTags(resultadosFrecuentesAux)" *ngIf="!showFrecuentes">MÁS FRECUENTES</button>
    </div>
</div>

<!-- RESULTADOS PRINCIPALES -->
<ul *ngIf="!showFrecuentes && !showRefSets && resultados && resultados.length > 0" class="conceptos list-unstyled">
    <ng-container *ngFor="let item of resultados">
        <li draggable class="" *ngIf="!hideLista" [dragHandle]="'.drag-bar'" [dragScope]="_dragScope" [dragOverClass]="_dragOverClass" [dragData]="item" (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
            <div class="rup-card mini {{ ((tipoBusqueda === 'planes' || esTurneable(item)) ? 'planes' : ((item.semanticTag === 'régimen/tratamiento') ? 'regimen' : item.semanticTag)) }}">
                <div *ngIf="_dragScope" class=" type">
                    <i #dragHandle class="drag-bar drag-handle mdi mdi-drag-vertical"></i>
                </div>

                <div class="rup-content">
                    <div class="header row m-0 pl-0" [ngClass]="{'actions-left': tipoBusqueda === 'equipamientos'}">
                        <div class="title col-6">
                            {{ item.term }}
                        </div>
                        <div class="col pr-1" [ngClass]="{'float-right text-right': _dragScope, 'd-flex': tipoBusqueda === 'equipamientos'}">

                            <small class="badge badge-{{ ((tipoBusqueda === 'planes' || esTurneable(item)) ? 'planes' : ((item.semanticTag === 'régimen/tratamiento') ? 'regimen' : item.semanticTag + 's')) }} text-default">{{ (tipoBusqueda === 'planes' || esTurneable(item)) ? 'plan' : item.semanticTag }}
                            </small>
                            <a href="javascript: void(0)" (click)="seleccionarConcepto(item)">
                                <i class="mdi mdi-plus-box"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </li>
    </ng-container>
</ul>

<div *ngIf="arrayFrecuentes && arrayFrecuentes.length > 0 && showFrecuentes">
    <ul class="conceptos list-unstyled">
        <ng-container *ngFor="let item of arrayFrecuentes">

            <li draggable [dragScope]="'registros-rup'" [dragData]="item" (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                <div class="rup-card mini {{ ((tipoBusqueda === 'planes' || esTurneable(item)) ? 'planes' : ((item.semanticTag === 'régimen/tratamiento') ? 'regimen' : item.semanticTag)) }}">
                    <div class="type">
                        <i #dragHandle class="drag-bar mdi mdi-drag-vertical"></i>
                    </div>
                    <div class="rup-content">
                        <div class="header">
                            <div class="title">
                                {{item.term}}
                            </div>
                            <div class="actions">
                                <a href="javascript: void(0)" (click)="seleccionarConcepto(item)">
                                    <i class="mdi mdi-plus-box-outline"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ng-container>
    </ul>
</div>

<!-- refsetids -->
<div *ngIf="showRefSets && !showFrecuentes">

    <ul class="conceptos list-unstyled">
        <!-- <plex-accordion> -->
        <ng-container *ngFor="let items of arrayPorRefsets, let i = index;">
            <li>
                <div class="rup-card mini">
                    <div class="container rup-content">
                        <div class="row header">
                            <div class="col-10">
                                <b>{{items.nombre}}</b>
                            </div>
                            <div class="col-1">
                                <span class="badge-warning">
                                    {{ items.valor.length }}
                                </span>
                            </div>
                            <div class="col-1">
                                <a href="javascript: void(0)" class="btn btn-sm btn-primary" (click)='desplegar(i , items.nombre)'>
                                    <i class="mdi mdi-chevron-down"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>


                <div *ngIf="showContent === items.nombre">
                    <ng-container *ngIf="items.valor.length === 0">
                        <p>No hay resultados</p>
                    </ng-container>
                    <ul class="conceptos list-unstyled">
                        <ng-container *ngFor="let item of items.valor">
                            <li draggable class="" *ngIf="!hideLista" [dragHandle]="'.drag-bar'" [dragScope]="_dragScope" [dragOverClass]="_dragOverClass" [dragData]="item" (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                                <div class="rup-card mini {{ (tipoBusqueda === 'planes' && item.semanticTag  === 'procedimiento') ? 'planes' : item.semanticTag}}">
                                    <div *ngIf="_dragScope" class=" type">
                                        <i #dragHandle class="drag-bar drag-handle mdi mdi-drag-vertical"></i>
                                    </div>
                                    <div class="rup-content">
                                        <div class="header" [ngClass]="{'actions-left': tipoBusqueda === 'equipamientos'}">
                                            <div class="title">
                                                {{ item.term }}
                                            </div>
                                            <div [ngClass]="{'actions': _dragScope, 'actions-left': tipoBusqueda === 'equipamientos'}">
                                                <small class="badge badge-{{ (tipoBusqueda === 'planes' && item.semanticTag  === 'procedimiento') ? 'planes' : item.semanticTag}} text-default">{{ item.semanticTag }}</small>
                                                <a href="javascript: void(0)" (click)="seleccionarConcepto(item)">
                                                    <i class="mdi mdi-plus-box-outline"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ng-container>
                    </ul>
                </div>
            </li>
        </ng-container>
    </ul>
</div>















<!-- <h5>Filtros</h5>
<div class="menu-buscador">
    <plex-button label="HALLAZGOS" (click)="filtroBuscadorSnomed('problemas')" type=" btn-sm btn-problemas"></plex-button>
    <plex-button label="PROCEDIMIENTOS" (click)="filtroBuscadorSnomed('procedimientos')" type=" btn-sm btn-procedimientos"></plex-button>
    <plex-button label="PLANES" (click)="filtroBuscadorSnomed('planes')" type=" btn-sm btn-planes"></plex-button>
</div> -->


<!-- <div *ngIf="listaPlanes && listaPlanes.length === 0 && !loading">
    No se han encontrado resultados
</div> -->

<!-- Cargando... -->
<!-- <plex-loader *ngIf="loading" type="ball-pulse"></plex-loader>

<div *ngIf="arrayFrecuentes">
    <ul class="conceptos list-unstyled">
        <ng-container *ngFor="let item of arrayFrecuentes">

            <li *ngIf="tipoBusqueda === 'procedimientos' && (item.semanticTag === 'procedimiento' || item.semanticTag === 'entidad observable') || tipoBusqueda === 'problemas' && (item.semanticTag === 'trastorno' || item.semanticTag === 'hallazgo' || item.semanticTag === 'situación') || tipoBusqueda === 'planes' && (item.semanticTag === 'procedimientos')"
                draggable [dragScope]="'registros-rup'" [dragData]="item" (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                <div class="rup-card mini">
                    <div class="type">
                        <i #dragHandle class="drag-bar mdi mdi-drag-vertical"></i>
                    </div>
                    <div class="rup-content">
                        <div class="header">
                            <div class="title">
                                {{item.term}}
                            </div>
                            <div class="actions">
                                <a href="javascript: void(0)" (click)="seleccionBusqueda(item)">
                                    <i class="mdi mdi-plus-box-outline"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ng-container>
    </ul>
</div> -->