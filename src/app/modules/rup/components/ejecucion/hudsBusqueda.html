<div class="row mt-1">
    <div class="col">

        <div class="menu-huds">

            <span>
                <button class="btn btn-hallazgo btn-sm m-0" (click)="actualizarVista('hallazgos')" [ngClass]="{'active': vista === 'hallazgos'}">
                    <span>HALLAZGOS</span>
                </button>
            </span>
            <span>
                <button class="btn btn-plan btn-sm m-0" (click)="actualizarVista('prestaciones')" [ngClass]="{'active': vista === 'prestaciones'}">
                    <span>PRESTACIONES</span>
                </button>
            </span>
            <span>
                <button class="btn btn-producto btn-sm m-0" (click)="actualizarVista('medicamentos')" [ngClass]="{'active': vista === 'medicamentos'}">
                    <span>MEDICAMENTOS</span>
                </button>
            </span>

        </div>
    </div>
</div>
<div class="row">
    <div class="col">

        <!-- Vista: Hallazgos -->
        <ng-container *ngIf="vista === 'hallazgos'">

            <!-- HALLAZGOS CRÓNICOS ONLY -->
            <div class="vista-titulo">Hallazgos crónicos</div>
            <ul *ngIf="hallazgosCronicos" class="conceptos list-unstyled">
                <ng-container *ngFor="let hallazgo of hallazgosCronicos; let iCronico = index">
                    <li>
                        <div class="rup-card mini {{ servicioPrestacion.getCssClass(hallazgo.concepto, filtroActual) }}" [ngClass]="{'active': estaEnTabs(hallazgo, 'hallazgo')}"
                            (mouseenter)="eyeCronico = iCronico" (mouseleave)="eyeCronico = -1">
                            <div class="rup-header">

                                <ng-container *ngIf="emitirConceptos">
                                    <div class="icon-rup drag-handle" draggable [dragScope]="_dragScope" [dragOverClass]="_dragOverClass" [dragData]="{'tipo': 'hallazgo','data': hallazgo, 'huds': true}"
                                        (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                                        <i class="icon icon-rup-semantic-{{servicioPrestacion.getIcon(hallazgo.concepto, filtroActual)}}"></i>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="!emitirConceptos">
                                    <div class="icon-rup ">
                                        <i class="icon icon-rup-semantic-{{servicioPrestacion.getIcon(hallazgo.concepto, filtroActual)}}"></i>
                                    </div>
                                </ng-container>

                                <div class="title" (click)="devolverRegistrosHuds(hallazgo, 'hallazgo')">

                                    {{ hallazgo.concepto.term }}

                                    <ng-container *ngIf="hallazgo.evoluciones">
                                        <small class="sugerido">última evolución: {{ hallazgo.evoluciones[0].fechaCarga | fecha }}</small>
                                    </ng-container>
                                </div>


                                <div class="actions">
                                    <ng-container *ngIf="hallazgo.evoluciones">
                                        <small class="estado badge badge-success">{{ hallazgo.evoluciones[0].estado }}</small>
                                    </ng-container>

                                    <a href="javascript: void(0)" (click)="devolverRegistrosHuds(hallazgo, 'hallazgo')" *ngIf="iCronico === eyeCronico" title="Agregar a los tabs"
                                        titlePosition="bottom">
                                        <i class="mdi mdi-eye"></i>
                                    </a>
                                    <a *ngIf="emitirConceptos" href="javascript: void(0)" (click)="devolverHallazgo(hallazgo)" title="Agregar a la consulta"
                                        titlePosition="left">
                                        <i class="mdi mdi-plus-box"></i>
                                    </a>

                                </div>
                            </div>
                        </div>
                    </li>
                </ng-container>
            </ul>
            <div *ngIf="hallazgosCronicos.length === 0">No hay problemas crónicos</div>

            <!-- HALLAZGOS ACTIVOS ONLY -->
            <div class="vista-titulo">Hallazgos activos</div>
            <ul *ngIf="problemasActivos" class="conceptos list-unstyled">
                <ng-container *ngFor="let problema of problemasActivos; let iActivo = index">
                    <li>

                        <!-- <div class="rup-card mini {{problema.concepto.semanticTag}}" [ngClass]="{'active': eyeActivo === iActivo || estaEnTabs(problema, 'hallazgo')}" (mouseenter)="eyeActivo = iActivo" (mouseleave)="eyeActivo = -1"> -->
                        <div class="rup-card mini {{servicioPrestacion.getCssClass(problema.concepto, filtroActual)}}" [ngClass]="{'active': eyeActivo === iActivo || estaEnTabs(problema, 'hallazgo')}"
                            (mouseenter)="eyeActivo = iActivo" (mouseleave)="eyeActivo = -1">
                            <div class="rup-header">

                                <ng-container *ngIf="emitirConceptos">
                                    <div class="icon-rup drag-handle" draggable [dragScope]="_dragScope" [dragOverClass]="_dragOverClass" [dragData]="{'tipo': 'hallazgo','data': problema, 'huds': true}"
                                        (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                                        <i class="icon icon-rup-semantic-{{servicioPrestacion.getIcon(problema.concepto, filtroActual)}}"></i>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="!emitirConceptos">
                                    <div class="icon-rup">
                                        <i class="icon icon-rup-semantic-{{servicioPrestacion.getIcon(problema.concepto, filtroActual)}}"></i>
                                    </div>
                                </ng-container>

                                <div class="title" (click)="devolverRegistrosHuds(problema, 'hallazgo')">

                                    {{ problema.concepto.term }}


                                    <ng-container *ngIf="problema.evoluciones">
                                        <small class="sugerido">última evolución: {{ problema.evoluciones[0].fechaCarga | fecha }}</small>
                                    </ng-container>
                                </div>

                                <div class="actions">
                                    <ng-container *ngIf="problema.evoluciones">
                                        <small class="badge badge-success">{{ problema.evoluciones[0].estado }}</small>
                                    </ng-container>

                                    <a href="javascript: void(0)" (click)="devolverRegistrosHuds(problema, 'hallazgo')" *ngIf="iActivo === eyeActivo" title="Agregar a los tabs"
                                        titlePosition="bottom">
                                        <i class="mdi mdi-eye"></i>
                                    </a>

                                    <a *ngIf="emitirConceptos" href="javascript: void(0)" (click)="devolverHallazgo(problema)" title="Agregar a la consulta"
                                        titlePosition="bottom">
                                        <i class="mdi mdi-plus-box"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ng-container>
            </ul>
            <div *ngIf="problemasActivos.length === 0">No hay problemas activos</div>

            <!-- OTROS HALLAZGOS -->
            <div class="vista-titulo">Otros Hallazgos</div>
            <ul *ngIf="hallazgosNoActivos" class="conceptos list-unstyled">
                <ng-container *ngFor="let problema of hallazgosNoActivos; let iOtros = index">
                    <li>

                        <div class="rup-card mini  {{servicioPrestacion.getCssClass(problema.concepto, filtroActual)}}" [ngClass]="{'active': eyeOtros === iOtros || estaEnTabs(problema, 'hallazgo')}">
                            <div class="rup-header">

                                <ng-container *ngIf="emitirConceptos">
                                    <div class="icon-rup drag-handle" draggable [dragScope]="_dragScope" [dragOverClass]="_dragOverClass" [dragData]="{'tipo': 'hallazgo','data': problema, 'huds': true}"
                                        (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                                        <!-- <i *ngIf="emitirConceptos" #dragHandle class="drag-bar drag-handle mdi mdi-drag-vertical"></i> -->
                                        <i class="icon icon-rup-semantic-{{servicioPrestacion.getIcon(problema.concepto, filtroActual)}}"></i>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="!emitirConceptos">
                                    <div class="icon-rup">
                                        <i class="icon icon-rup-semantic-{{servicioPrestacion.getIcon(problema.concepto, filtroActual)}}"></i>
                                    </div>
                                </ng-container>


                                <div class="title" (click)="devolverRegistrosHuds(problema, 'hallazgo')" (mouseenter)="eyeOtros = iOtros" (mouseleave)="eyeOtros = -1">

                                    {{ problema.concepto.term }}

                                    <ng-container *ngIf="problema.evoluciones">
                                        <small class="sugerido">última evolución: {{ problema.evoluciones[0].fechaCarga | fecha }}</small>
                                        <span class="badge badge-info" *ngIf="problema.evoluciones[0].estado === 'transformado'">
                                            Transformado en: {{ problema.transformado?.concepto.term }}
                                        </span>
                                    </ng-container>

                                </div>

                                <div class="actions">
                                    <ng-container *ngIf="problema.evoluciones">
                                        <small class="badge badge-success">{{ problema.evoluciones[0].estado }}</small>

                                    </ng-container>

                                    <span *ngIf="iOtros === eyeOtros" class="float-right text-problemas p-1">
                                        <i class="mdi mdi-eye"></i>
                                    </span>

                                </div>
                            </div>
                        </div>
                    </li>
                </ng-container>
            </ul>
            <div *ngIf="hallazgosNoActivos.length === 0">No hay otros problemas</div>
        </ng-container>


        <!-- Vista: prestaciones -->
        <ng-container *ngIf="vista === 'prestaciones'">
            <div class="vista-titulo">Prestaciones</div>

            <ul *ngIf="prestaciones" class="conceptos list-unstyled">
                <ng-container *ngFor="let prestacion of prestaciones; let iPrestacion = index">
                    <li>
                        <div class="rup-card mini plan" [ngClass]="{'active': eyePrestacion === iPrestacion || estaEnTabs(prestacion, 'prestacion')}">
                            <div class="rup-header">
                                <div class="icon-rup drag-handle">

                                </div>

                                <div class="title" (click)="devolverRegistrosHuds(prestacion, 'prestacion')" (mouseenter)="eyePrestacion = iPrestacion" (mouseleave)="eyePrestacion = -1">
                                    {{ prestacion.solicitud.tipoPrestacion.term }} ({{ prestacion.estados[prestacion.estados.length - 1].createdAt | fecha }})

                                    <div class="sugerido">
                                        <small>Profesional: {{ prestacion.estados[prestacion.estados.length - 1].createdBy.nombreCompleto}}</small>
                                    </div>
                                </div>

                                <div class="actions">
                                    <span class="badge badge-{{prestacion.estados[prestacion.estados.length - 1].tipo}}">{{prestacion.estados[prestacion.estados.length - 1].tipo}} </span>

                                    <span *ngIf="iPrestacion === eyePrestacion" class="float-right text-planes m-r-2">
                                        <i class="mdi mdi-eye"></i>
                                    </span>
                                </div>
                            </div>


                        </div>

                    </li>
                </ng-container>
            </ul>
        </ng-container>

        <!-- Vista: medicamentos -->
        <ng-container *ngIf="vista === 'medicamentos'">
            <div class="vista-titulo">Medicamentos</div>

            <div *ngIf="medicamentos" class="conceptos list-unstyled">
                <ul *ngIf="medicamentos" class="conceptos list-unstyled">
                    <ng-container *ngFor="let medicamento of medicamentos; let iCronico = index">

                        <li>

                            <div class="rup-card mini producto" [ngClass]="{'active': eyeCronico === iCronico || estaEnTabs(medicamento, 'medicamento')}"
                                (mouseenter)="eyeCronico = iCronico" (mouseleave)="eyeCronico = -1">
                                <div class="rup-header">

                                    <ng-container *ngIf="emitirConceptos">
                                        <div class="icon-rup" draggable class="" [dragScope]="_dragScope" [dragOverClass]="_dragOverClass" [dragData]="{'tipo': 'medicamento','data': medicamento, 'huds': true}"
                                            (onDragStart)="dragStart($e)" (onDragEnd)="dragEnd($e)">
                                            <i class="icon icon-rup-semantic-producto"></i>
                                        </div>
                                    </ng-container>
                                    <ng-container *ngIf="!emitirConceptos">
                                        <div class="icon-rup">
                                            <i class="icon icon-rup-semantic-producto"></i>
                                        </div>
                                    </ng-container>

                                    <div class="title" (click)="devolverRegistrosHuds(medicamento, 'medicamento')">
                                        {{ medicamento.concepto.term }}

                                        <ng-container *ngIf="medicamento.evoluciones">
                                            <small class="sugerido">último registro: {{ medicamento.evoluciones[0].fechaCarga | fecha }}</small>
                                        </ng-container>
                                    </div>

                                    <div class="actions">
                                        <ng-container *ngIf="medicamento.evoluciones">
                                            <small class="badge badge-success">{{ medicamento.evoluciones[medicamento.evoluciones.length-1].estado }}</small>
                                        </ng-container>

                                        <a *ngIf="iCronico === eyeCronico" href="javascript: void(0)" (click)="devolverRegistrosHuds(medicamento, 'medicamento')"
                                            title="Agregar a los tabs" titlePosition="bottom">
                                            <i class="mdi mdi-eye"></i>
                                        </a>

                                        <a *ngIf="emitirConceptos" href="javascript: void(0)" (click)="devolverMedicamento(medicamento)" title="Agregar a la consulta"
                                            titlePosition="left">
                                            <i class="mdi mdi-plus-box"></i>
                                        </a>
                                    </div>

                                </div>

                            </div>
                        </li>
                    </ng-container>
                </ul>
                <div *ngIf="medicamentos.length === 0">No hay medicamentos registrados</div>
            </div>
        </ng-container>
    </div>
</div>
