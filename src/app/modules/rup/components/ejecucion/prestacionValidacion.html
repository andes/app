<header *ngIf="prestacion">
    <header-paciente [paciente]="prestacion.paciente"></header-paciente>
</header>
<section *ngIf="!showDarTurnos && prestacion && paciente">
    <plex-box>
        <header>
            <div class="clearfix">
                <div *ngIf="prestacion?.solicitud">
                    <div class="page-title">Resumen <b>{{prestacion.solicitud.tipoPrestacion.term}}</b></div>
                </div>
            </div>
        </header>
        <div class="row">
            <ng-container *ngFor="let elemento of prestacion.ejecucion.registros; let i = index">
                <div class="col-4">
                    <div class="rup-card">
                        <div class="type {{elemento.concepto.semanticTag}}">
                        </div>
                        <div class="rup-content">
                            <div class="header">
                                <div class="row">
                                    <div class="col-9">
                                        <div class="title">
                                            {{elemento.nombre}}
                                        </div>
                                    </div>
                                    <div class="col-3"> <small>
                                        <b>{{elemento.concepto.semanticTag}}</b>
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="rup-body">
                                <rup [paciente]="prestacion.paciente" [elementoRUP]="elementosRUPService.buscarElemento(elemento.concepto, elemento.esSolicitud)" [prestacion]="prestacion" [registro]="elemento" [soloValores]="true">
                                </rup>
                            </div>
                            <div class="rup-footer">
                                <div *ngIf="elemento.esSolicitud && prestacion.estados[prestacion.estados.length-1].tipo === 'validada'">
                                    <!-- <p *ngIf="tienePermisos(elemento.concepto) && !elemento?.prestacionPlan?.solicitud?.turno"> -->
                                        <plex-button label="Asignar turno" type="primary" (click)="darTurno(elemento.prestacionSolicitud)"></plex-button>
                                    <!-- </p> -->
                                </div>
                                <div *ngIf="elemento.relacionadoCon && elemento.relacionadoCon.length > 0">
                                    <strong>Relacionado con:</strong>
                                    <!--*ngFor="let r of registro.relacionadoCon"-->
                                    <ng-container>
                                        {{elemento.relacionadoCon[0].concepto.term}}
                                    </ng-container>
                                </div>
                                <div *ngIf="!diagnosticoReadonly && elemento.concepto.semanticTag === 'hallazgo' || elemento.concepto.semanticTag ==='situación' || elemento.concepto.semanticTag === 'trastorno'"> 
                                    <plex-bool [readonly]="diagnosticoReadonly" [(ngModel)]="elemento.esDiagnosticoPrincipal" type="slide" label="Diagnostico principal" name="Diagnostico principal" (click)="diagnosticoPrestacion(i)"></plex-bool>
                                </div>
                                <div *ngIf="diagnosticoReadonly && elemento.esDiagnosticoPrincipal && (elemento.concepto.semanticTag === 'hallazgo' || elemento.concepto.semanticTag ==='situación' || elemento.concepto.semanticTag === 'trastorno')">
                                        Diagnostico principal
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </plex-box>
</section>
<footer *ngIf="!showDarTurnos">
    <div class="row">
        <div class="col-3">
            <plex-button *ngIf="prestacion && prestacion.estados && prestacion.estados[prestacion.estados.length-1].tipo === 'ejecucion'"
                 label="VOLVER" (click)="volver()" type="danger"></plex-button>

            <plex-button *ngIf="prestacion && prestacion.estados && prestacion.estados[prestacion.estados.length-1].tipo === 'validada'"
                 label="VOLVER" (click)="volverInicio()" type="danger"></plex-button>
        </div>
        <div class=" col-6 text-center">
        </div>
        <div class="col text-right ">

            <plex-button *ngIf="prestacion && prestacion.estados && prestacion.estados[prestacion.estados.length-1].tipo !== 'validada'"
                label="VALIDAR" (click)="validar()" type="success"></plex-button>

            <plex-button label="ROMPER VALIDACION" (click)="romperValidacion()" type="warning" *ngIf="prestacion && prestacion.estados
                && prestacion.estados[prestacion.estados.length-1].tipo === 'validada'
                && prestacion.estados[prestacion.estados.length-1].createdBy.username === auth.usuario.username">
            </plex-button>
        </div>
    </div>
</footer>

<!-- Calendario para dar turnos autocitados -->
<!-- <pre> {{solicitudTurno | json}}</pre> -->
<dar-turnos *ngIf="showDarTurnos && solicitudTurno" (cancelarDarTurno)="turnoDado($event)" [pacienteSeleccionado]="paciente" [solicitudPrestacion]="solicitudTurno" (cancelarDarTurno)="showDarTurnos = false"></dar-turnos>