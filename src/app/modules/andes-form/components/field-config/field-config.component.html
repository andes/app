<div [formGroup]="form">
    <plex-title titulo="CREAR CAMPOS" size="md">
        <plex-button type="success" icon="check" size="sm" tooltip="Guardar" class="m-1"
            (click)="onSaveField()"></plex-button>
        <plex-button type="danger" icon="close" size="sm" tooltip="Cerrar" class="ml-1 mr-1"
            (click)="closeFieldConfig()"></plex-button>
    </plex-title>
    <plex-text name="field-name" label="Nombre" formControlName="name"></plex-text>
    <plex-text name="field-key" label="Key" formControlName="key"></plex-text>
    <plex-select name="field-type" label="Tipo de campo" formControlName="type"
        [data]="tiposList"></plex-select>
    <plex-bool type="slide" name="field-required" label="Campo Obligatorio" formControlName="required"
        class="mt-3"></plex-bool>
    <plex-bool *ngIf="type?.id === 'date'" type="slide" name="date-period"
        label="Fecha desde/hasta" formControlName="datePeriod" class="mt-3"></plex-bool>
    <plex-bool type="slide" name="hasDependency" label="Tiene dependencia"
        formControlName="hasDependency"></plex-bool>
    <plex-text name="field-description" label="Descripción" formControlName="description"></plex-text>
    <!-- Campo dinámico select -->
    <plex-select *ngIf="type?.id === 'select'" label="Tipo de recurso" name="field-resources"
        required="true" formControlName="resources" [data]="resources" labelField="name"></plex-select>
    <!-- Campos dinámicos numérico -->
    <plex-int *ngIf="type?.id === 'int'" label="Mínimo" name="minimo-{{ this.form.name }}"
        formControlName="min"></plex-int>
    <plex-int *ngIf="type?.id === 'int'" label="Maximo" name="maximo-{{ this.form.name }}"
    formControlName="max"></plex-int>
    <!-- Campos dinámicos dependencia -->
    <div *ngIf="hasDependency" formGroupName="dependencies">
        <plex-title titulo="Configuración dependencia" size="sm">
            <plex-button type="success" icon="plus" size="sm" tooltip="Nueva dependencia" 
                (click)="onAddDependency()" class=""></plex-button>
        </plex-title>
        <ng-container *ngFor="let dependency of dependencies.controls; let dependencyIndex = index" [formGroup]="dependency">
            <plex-select name="type-dependency" label="Tipo de dependencia" formControlName="type" [data]="typeDependency"></plex-select>
            <plex-select name="condition-dependency" label="Condición" formControlName="condition" [data]="typeComparison"></plex-select>
            <plex-select name="action-dependency" label="Acción" formControlName="action" [data]="action"></plex-select>
            <plex-select name="section" label="Sección" formControlName="section" (getData)="getSectionList($event)"></plex-select>
            <plex-select *ngIf="dependency.get('section').value" name="field-dependency" label="Key del campo" formControlName="field" (getData)="getFieldList(dependency, event)"></plex-select>
            <!-- <plex-select *ngIf="type?.id === 'select' && this.dependencies.at(dependencyIndex).get('field')?.value"
            name="value-dependency" label="Valor" formControlName="value" [data]="getDataForValueSelect()"></plex-select> -->
        </ng-container>
    </div>
    <!-- Campos dinámicos select static -->
    <br>
    <plex-table *ngIf="type?.id === 'selectStatic'" [columns]="selectColumns" #table="plTable" formArrayName="selectList">
        <plex-title titulo="ELEMENTOS SELECCIONABLES" size="sm">
            <plex-button type="success" icon="plus" size="sm" tooltip="Agregar" class="mr-1"
                (click)="addSelectItem()">
            </plex-button>
        </plex-title>
        <plex-table-columns></plex-table-columns>
        <tr  *ngFor="let selectItem of selectList.controls; let selectIndex = index" [formGroup]="selectItem">
            <td *plTableCol="'name'">
                <plex-text name="item-{{selectIndex}}" formControlName="name"placeholder="nombre">
                </plex-text>
            </td>
            <td *plTableCol="'actions'">
                <plex-button type="danger" icon="delete" align="center" tooltip="Eliminar" size="sm"
                    (click)="deleteSelectItem(selectIndex)"></plex-button>
            </td>
        </tr>
    </plex-table>
     
</div>