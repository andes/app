<plex-layout main="8">
    <plex-layout-main>
        <header>
            <plex-title titulo="Mapa de Camas">
                <plex-button label="LISTA DE ESPERA" type="primary" (click)="gotoListaEspera()"></plex-button>
                <plex-button label="LISTADO DE INTERNACIÃ“N" type="primary" (click)="verListadoInternacion()">
                </plex-button>
                <plex-dropdown label="VER CENSO" type="primary" class="d-inline-block" [items]="itemsDropdown">
                </plex-dropdown>
                <plex-button label="VOLVER" type="danger" (click)="volver()"></plex-button>
            </plex-title>

            <app-filtros-camas></app-filtros-camas>

            <plex-title titulo="LISTADO DE CAMAS" size="sm">
                <plex-button label="AGREGAR CAMA" type="success" size="sm" (click)="agregarCama()"></plex-button>
                <plex-button title="forma de lista" icon="format-list-bulleted" type="primary" size="sm"></plex-button>
            </plex-title>

        </header>
        <fieldset>
            <table class="table table-striped table-hover">
                <tr>
                    <th>CAMA</th>
                    <th>PACIENTE</th>
                    <th>UNIDAD ORGANIZATIVA</th>
                    <th>ESTADO</th>
                    <th>ACCIONES</th>
                </tr>
                <ng-container *ngIf="(selectedCama$ | async) as selectedCama">
                    <tr app-item-cama *ngFor="let cama of camas | async" [cama]="cama"
                        (accionCama)="selectCama(cama, $event)" (click)="verDetalle(cama, selectedCama)"
                        [class.invert]="cama._id === selectedCama._id">
                    </tr>
                </ng-container>
            </table>
        </fieldset>
    </plex-layout-main>
    <plex-layout-sidebar type="invert">
        <app-estado-servicio *ngIf="!accion"></app-estado-servicio>
        <ng-container *ngIf="selectedPaciente$ | async as selectedPaciente">
            <app-elegir-paciente *ngIf="(selectedPaciente.id === null) && (accion === 'internarPaciente')">
                <plex-button title="volver" icon="arrow-left" type="danger" size="sm" (click)="volverAResumen()">
                </plex-button>
            </app-elegir-paciente>
            <app-ingresar-paciente *ngIf="(selectedPaciente.id !== null) && (accion === 'internarPaciente')"
                                   (onSave)="volverAResumen()" (volver)="mapaCamasService.selectPaciente(null)">
                <plex-button title="volver" icon="arrow-left" type="danger" size="sm"
                             (click)="mapaCamasService.selectPaciente(null)">
                </plex-button>
            </app-ingresar-paciente>
        </ng-container>
        <app-desocupar-cama *ngIf="accion === 'desocuparCama'" (accionDesocupar)="accionDesocupar($event)">
            <plex-button title="volver" icon="arrow-left" type="danger" size="sm" (click)="volverAResumen()">
            </plex-button>
        </app-desocupar-cama>
        <app-cambiar-cama *ngIf="accion === 'cambiarCama'" cambiarUO="{{ cambiarUO }}" (onSave)="volverAResumen()">
            <plex-button title="volver" icon="arrow-left" type="danger" size="sm" (click)="volverAResumen()">
            </plex-button>
        </app-cambiar-cama>
        <app-egresar-paciente *ngIf="accion === 'egresarPaciente'" (onSave)="volverAResumen()"
                              (cancel)="volverAResumen()">
            <plex-button title="volver" icon="arrow-left" type="danger" size="sm" (click)="volverADesocupar()">
            </plex-button>
        </app-egresar-paciente>
        <app-cama-destino-generico *ngIf="accion === 'accionGenerica'" [destino]="estadoDestino"
                                   (onSave)="volverAResumen()">
            <plex-button icon="arrow-left" type="danger" size="sm" (click)="volverAResumen()">
            </plex-button>
        </app-cama-destino-generico>
        <ng-container *ngIf="(selectedCama$ | async) as selectedCama">
            <app-cama-detalle *ngIf="accion === 'verDetalle'" (cancel)="volverAResumen()"
                              (accionCama)="selectCama(selectedCama, $event)" (refresh)="refresh($event)">
            </app-cama-detalle>
        </ng-container>
    </plex-layout-sidebar>
</plex-layout>