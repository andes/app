<ng-container *ngIf="!paciente">
    <plex-title justify titulo="INGRESAR PACIENTE">
        <plex-button icon="arrow-left" type="danger" size="sm" (click)="cancelar()">
        </plex-button>
    </plex-title>
    <fieldset>
        <div class="row">
            <div class="col">
                <paciente-buscar (searchStart)="searchStart()" (searchEnd)="searchEnd($event)"
                                 (data)="onPacienteCancel()">
                </paciente-buscar>
            </div>
        </div>
        <paciente-listado [pacientes]="pacientes" [autoselect]="false" (selected)="onPacienteSelected($event)">
        </paciente-listado>
    </fieldset>
</ng-container>
<form #formIngreso="ngForm">

    <ng-container *ngIf="paciente && informeIngreso">
        <plex-title justify titulo="INGRESO">
            <plex-button icon="arrow-left" type="danger" size="sm" (click)="cancelar()">
            </plex-button>
            <plex-button icon="check" type="success" size="sm" [validateForm]="formIngreso" (click)="guardar($event)">
            </plex-button>
        </plex-title>
        <fieldset>
            <div class="row">
                <div class="col-6">
                    <plex-button label="DATOS BÁSICOS" type="primary" size="block" [disabled]="datosBasicos"
                                 (click)="toggleDatos()">
                    </plex-button>
                </div>
                <div class="col-6">
                    <plex-button label="DATOS DE INTERNACION" type="primary" size="block" [disabled]="!datosBasicos"
                                 (click)="toggleDatos()">
                    </plex-button>
                </div>
            </div>
            <ng-container *ngIf="datosBasicos">
                <plex-title size="sm" justify titulo="DATOS BÁSICOS">
                    <plex-button label="CAMBIAR PACIENTE" type="warning" size="sm" (click)="cambiarPaciente()">
                    </plex-button>
                </plex-title>
                <fieldset>
                    <div class="row">
                        <div class="col">
                            <p>
                                <b>Apellido y nombre:</b> {{ paciente | paciente}}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>
                                <b>Documento:</b> {{ paciente.documento }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>
                                <b>Fecha de Nacimiento:</b> {{ paciente.fechaNacimiento | fecha }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>
                                <b>Sexo:</b> {{ paciente.sexo }}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <plex-datetime *ngIf="!soloValores && pedirHoraNac" type="time"
                                           [(ngModel)]="informeIngreso.horaNacimiento" [required]="pedirHoraNac"
                                           autoFocus="autoFocus" name="horaNac" label="Hora de nacimiento">
                            </plex-datetime>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <br>
                            <carpeta-paciente [pacienteSeleccionado]="paciente"
                                              (guardarCarpetaEmit)="afterComponenteCarpeta($event)"
                                              (cancelarCarpetaEmit)="afterComponenteCarpeta($event) ">
                            </carpeta-paciente>
                        </div>
                    </div>
                </fieldset>
            </ng-container>
            <ng-container *ngIf="!datosBasicos">
                <fieldset>
                    <div class="row">
                        <div class="col-md">
                            <plex-datetime label="Fecha y hora de ingreso" [(ngModel)]="informeIngreso.fechaIngreso"
                                           name="fechaIngreso" required label="Fecha Ingreso"
                                           (change)="cambiarFechaIngreso($event.value)">
                            </plex-datetime>
                        </div>
                    </div>
                    <div class="row">
                        <div *ngIf="!fechaValida" class="alert alert-danger">
                            La fecha y hora no puede ser mayor a la de hoy.
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md">
                            <plex-select [required]="true" [(ngModel)]="cama" name="cama" [data]="camas"
                                         placeholder="Elija cama" label="Cama" idField="nombre" labelField="nombre"
                                         (change)="cambiarSeleccionCama()">
                            </plex-select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md">
                            <plex-select [required]="true" [(ngModel)]="informeIngreso.origen" name="origen"
                                         [data]="origenHospitalizacion" placeholder="Seleccione..."
                                         label="Origen hospitalización" idField="nombre" labelField="nombre"
                                         (change)="changeOrigenHospitalizacion($event)">
                            </plex-select>
                        </div>
                        <div class="col-md">
                            <plex-select label="Profesional" [(ngModel)]="informeIngreso.profesional" name="profesional"
                                         (getData)="loadProfesionales($event)" [required]="true"
                                         labelField="apellido+' '+nombre">
                            </plex-select>

                        </div>
                    </div>

                    <div class="row" *ngIf="origenExterno">
                        <div class="col-md">
                            <plex-bool [(ngModel)]="check" type="slide" label="Otro" name="check"
                                       (change)="onchange($event)">
                            </plex-bool>
                        </div>
                    </div>
                    <div class="row" *ngIf="origenExterno">
                        <div class="col-md" *ngIf="!check">
                            <plex-select [(ngModel)]="informeIngreso.organizacionOrigen" name="organizacion"
                                         (getData)="loadOrganizacion($event)" label="Organización origen"
                                         placeholder="Seleccione la organización" labelField="nombre" [required]="true">
                            </plex-select>
                        </div>
                        <div class="col-md" *ngIf="check">
                            <plex-text label="Otro" name="otraOrganizacion"
                                       [(ngModel)]="informeIngreso.organizacionOrigen" [required]="true">
                            </plex-text>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md">
                            <plex-text label="Motivo de Internación" name="motivo" [(ngModel)]="informeIngreso.motivo">
                            </plex-text>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md">
                            <plex-select name="especialidad" [required]="true" [snomedExpression]="expr.Especialidades"
                                         [preload]="false" [(ngModel)]="informeIngreso.especialidades" [multiple]="true"
                                         label="Especialidad/es">
                            </plex-select>
                        </div>
                    </div>
                    <div class="row" *ngIf="workflowC && !camaSelected">
                        <div class="col-md">
                            <plex-select name="unidadOrganizativa" [data]="listaUnidadesOrganizativas" idField="term"
                                         labelField="term" [(ngModel)]="informeIngreso.PaseAunidadOrganizativa"
                                         label="Unidad organizativa"
                                         (change)="selectCamasDisponibles(informeIngreso.PaseAunidadOrganizativa, fecha, hora)">
                            </plex-select>
                        </div>
                    </div>
                    <div class="row" *ngIf="workflowC && !camaSelected && informeIngreso.PaseAunidadOrganizativa">
                        <div class="col-md" *ngIf="listadoCamas && listadoCamas.length > 0">
                            <plex-select name="camasDisponibles" [data]="listadoCamas" idField="nombre"
                                         labelField="nombre" [(ngModel)]="cama" label="Camas">
                            </plex-select>
                        </div>
                        <div class="col-md" *ngIf="listadoCamas && listadoCamas.length  === 0">
                            <h6>
                                <strong>
                                    No hay camas disponibles para esta unidad organizativa. El paciente
                                    ingresará a
                                    lista de espera. </strong>
                            </h6>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <plex-title size="sm" justify titulo="COBERTURA SOCIAL"></plex-title>
                    <div class="row">
                        <div class="col-md">
                            <plex-select *ngIf="!soloValores && !informeIngreso.obraSocial"
                                         [(ngModel)]="informeIngreso.asociado" name="asociado" [data]="pacienteAsociado"
                                         placeholder="Seleccione... " label="Cobertura" idField="nombre"
                                         labelField="nombre">
                            </plex-select>
                            <plex-text *ngIf="!soloValores && informeIngreso.obraSocial"
                                       [(ngModel)]="informeIngreso.obraSocial" label="Obra Social" name="obraSocial"
                                       [readonly]="true"></plex-text>
                        </div>
                    </div>
                </fieldset>
                <fieldset>

                    <plex-title size="sm" justify titulo="DATOS ESTADISTICOS"></plex-title>
                    <div class="row">
                        <div class="col-6" *ngIf="situacionesLaborales">
                            <plex-select label=" Situación laboral " [(ngModel)]="informeIngreso.situacionLaboral"
                                         name="situacionLaboral" [data]="situacionesLaborales"
                                         placeholder="Seleccione... " labelField="nombre">
                            </plex-select>
                        </div>
                        <div class="col-6 ">
                            <plex-select label="Ocupación habitual " [(ngModel)]="informeIngreso.ocupacionHabitual"
                                         name="ocupacionHabitual" (getData)="getOcupaciones($event)"
                                         placeholder="Seleccione... " labelField="nom">
                            </plex-select>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <plex-select [(ngModel)]="informeIngreso.nivelInstruccion" name="nivelInstruccion"
                                         [data]="nivelesInstruccion" placeholder="Seleccione..."
                                         label="Nivel instrucción" idField="nombre" labelField="nombre">
                            </plex-select>
                        </div>
                    </div>
                </fieldset>
            </ng-container>
        </fieldset>
    </ng-container>
</form>