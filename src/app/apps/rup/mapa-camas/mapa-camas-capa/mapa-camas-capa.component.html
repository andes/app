<plex-layout main="8">
    <plex-layout-main>
        <header>
            <plex-title titulo="Mapa de Camas">
                <plex-button label="LISTA DE ESPERA" type="primary" (click)="gotoListaEspera()"></plex-button>
                <plex-button label="LISTADO DE INTERNACIÃ“N" type="primary" (click)="verListadoInternacion()">
                </plex-button>
                <plex-dropdown label="VER CENSO" type="primary" class="d-inline-block" [items]="itemsDropdown">
                </plex-dropdown>
                <plex-button label="VOLVER" type="danger" (click)="volver()"></plex-button>
            </plex-title>
            <app-filtros-camas *ngIf="unidadesOrganizativas && sectores && tiposCama"
                               [unidadesOrganizativas]="unidadesOrganizativas" [sectores]="sectores"
                               [tiposCama]="tiposCama" (filtrarTabla)="filtrarTabla($event)"></app-filtros-camas>
            <plex-title titulo="LISTADO DE CAMAS" size="sm">
                <plex-button label="AGREGAR CAMA" type="success" size="sm" (click)="agregarCama()"></plex-button>
                <plex-button icon="format-list-bulleted" type="primary" size="sm"></plex-button>
            </plex-title>
        </header>
        <fieldset *ngIf="snapshot">
            <table class="table table-striped table-hover" *ngIf="estados">
                <tr>
                    <th>CAMA</th>
                    <th>PACIENTE</th>
                    <th>UNIDAD ORGANIZATIVA</th>
                    <th>ESTADO</th>
                    <th>ACCIONES</th>
                </tr>
                <tr app-item-cama *ngFor="let cama of camas | async; let i=index;" [cama]="cama" [estados]="estados"
                    [relaciones]="relaciones" [selected]="(selectedCama && cama._id === selectedCama._id)"
                    (accionCama)="selectCama($event)" (click)="verDetalle(i)"
                    [ngClass]="{'invert': (selectedCama && cama._id === selectedCama._id)}">
                </tr>
            </table>
        </fieldset>
    </plex-layout-main>
    <plex-layout-sidebar type="invert" *ngIf="snapshot">
        <app-estado-servicio *ngIf="!accion" [fecha]="fecha" [camas]="snapshot" [estados]="estados"
                             [relaciones]="relaciones" (buscarEstados)="getSnapshot($event)">
        </app-estado-servicio>
        <app-informe-ingreso *ngIf="accion === 'internarPaciente'" [camas]="opcionesCamas" [cama]="selectedCama"
                             (cancel)="volverAResumen()" (cambiarFecha)="getSnapshot($event)"
                             (cambiarCama)="cambiarCama($event)" (refresh)="refresh($event)">
        </app-informe-ingreso>
        <app-desocupar-cama *ngIf="accion === 'desocuparCama'" [fecha]="fecha" [camas]="snapshot"
                            [selectedCama]="selectedCama" (cancel)="volverAResumen()"
                            (cambiarFecha)="getSnapshot($event)" (accionDesocupar)="accionDesocupar($event)">
        </app-desocupar-cama>

        <app-cambiar-cama *ngIf="accion === 'cambiarCama'" [camas]="snapshot" [cama]="selectedCama"
                          (refresh)="refresh($event)">
        </app-cambiar-cama>
        <app-egresar-paciente *ngIf="accion === 'egresarPaciente'" [fecha]="fecha" [cama]="selectedCama"
                              (cancel)="volverAResumen()" (refresh)="refresh($event)">
        </app-egresar-paciente>
        <app-cama-destino-generico *ngIf="accion === 'accionGenerica'" [fecha]=" fecha" [camas]="opcionesCamas"
                                   [selectedCama]="selectedCama" [destino]="estadoDestino" (cancel)="volverAResumen()"
                                   (cambiarFecha)="getSnapshot($event)" (cambiarCama)="cambiarCama($event)"
                                   (refresh)="refresh($event)">
        </app-cama-destino-generico>
        <app-cama-detalle *ngIf="accion === 'verDetalle'" [fecha]="fecha" [camas]="opcionesCamas" [cama]="selectedCama"
                          [estados]="estados" [relaciones]="relaciones" (cancel)="volverAResumen()"
                          (accionCama)="selectCama($event)" (refresh)="refresh($event)">
        </app-cama-detalle>
    </plex-layout-sidebar>
</plex-layout>